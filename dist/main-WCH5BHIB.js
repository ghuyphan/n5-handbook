import{B as H,C as j,D as W,E as U,F as O,H as R,a as n,b as T,c as p,d as l,e as S,f as u,g as A,h as k,i as v,j as g,k as m,l as h,m as B,n as P,o as I,p as C,q as x,r as b,s as M,t as N,u as V,v as f,w as q,x as D,y as z,z as $}from"./chunk-E4H4PFGS.js";var d;window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),d=a,n.installAppBtn&&(n.installAppBtn.style.display="flex")});async function Q(){if(d){d.prompt();let{outcome:a}=await d.userChoice;console.log(`User response to the install prompt: ${a}`),d=null,n.installAppBtn&&(n.installAppBtn.style.display="none")}}window.addEventListener("appinstalled",()=>{n.installAppBtn&&(n.installAppBtn.style.display="none"),d=null,console.log("PWA was installed")});async function X(){let a=["kanji","vocab"],t=[];for(let e of a)l.appData[e]||t.push(U(l.currentLevel,e));if(t.length>0)try{await Promise.all(t)}catch(e){console.error("Failed to load required data for progress dashboard:",e)}}async function w(a,...t){await I(a,...t),a==="progress"&&b();let e=!["progress","external-search"].includes(a),i=document.querySelectorAll(".notes-header-btn");if(i.forEach(s=>{s.classList.toggle("visible",e)}),e){let s=await R(l.currentLevel,a),o=s&&typeof s=="object"?!!s.content?.trim():!!s?.trim();i.forEach(r=>{r.classList.toggle("has-note",o)})}}function Y(){return'<label class="theme-switch"><input type="checkbox" aria-label="Theme toggle"><span class="slider"></span></label>'}function F(){return'<div class="lang-switch-pill"></div><button data-lang="en">EN</button><button data-lang="vi">VI</button>'}function Z(a){a&&(a.level!==l.currentLevel?h(a.level,!0):w(a.tabName,null,!1,!0))}function ee(){document.body.addEventListener("click",t=>{let e=t.target.closest("[data-action]");if(!e)return;let i=e.dataset.action,s={"change-tab":()=>w(e.dataset.tabName,e),"toggle-sidebar":()=>{n.sidebar?.classList.add("open"),n.overlay?.classList.add("active"),document.body.classList.add("sidebar-open")},"toggle-theme":()=>m(),"toggle-pin":()=>B(),"toggle-sidebar-pin":o=>P(o,e.dataset.tabName),"flip-card":()=>{e.closest(".card").classList.toggle("is-flipped")},"toggle-learned":()=>A(e.dataset.category,e.dataset.id,e),"jump-to-section":()=>C(e.dataset.tabName,e.dataset.sectionKey),"delete-level":()=>x(e.dataset.levelName),"set-level":()=>h(e.dataset.levelName),"toggle-accordion":()=>k(e),"clear-search":()=>{let o=e.dataset.target;if(o){let r=document.querySelector(o);r&&(r.value="",r.dispatchEvent(new Event("input",{bubbles:!0})))}}};s[i]&&(i==="toggle-sidebar-pin"?s[i](t):s[i]()),i==="open-notes"&&import("./modals-ZZIZDEEP.js").then(o=>o.openNotesModal()),i==="show-kanji-details"&&import("./modals-ZZIZDEEP.js").then(o=>o.openKanjiDetailModal(e.dataset.id))}),n.overlay?.addEventListener("click",f),n.searchInput?.addEventListener("input",v),n.mobileSearchInput?.addEventListener("input",v),n.closeSidebarBtn?.addEventListener("click",f);let a=S(()=>{document.querySelectorAll(".lang-switch").forEach(M);let t=window.innerWidth<=768;if(n.pinToggle&&(n.pinToggle.style.display=t?"block":"none",t)){let e=document.querySelector(".tab-content.active");e&&V(e.id)}},100);window.addEventListener("resize",a),window.addEventListener("popstate",t=>{Z(t.state)}),n.installAppBtn&&n.installAppBtn.addEventListener("click",Q)}function te(){n.sidebarControls&&(n.sidebarControls.innerHTML=`
            <div class="sidebar-control-group"><label class="sidebar-control-label" data-lang-key="level">Level</label><div id="level-switcher-sidebar" class="level-switch"></div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="language">Language</label><div id="sidebar-lang-switcher" class="lang-switch">${F()}</div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="theme">Theme</label><div class="theme-switch-wrapper">${Y()}</div></div>
            <button id="install-app-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button" style="display: none;">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1h4a1 1 0 001-1V2zm-1 5a1 1 0 011 1v10a1 1 0 11-2 0V8a1 1 0 011-1zm-4-4h2V2H5v2zM15 4h-2V2h2v2zm-2 4h-2v10h2V8z"/></svg>
                <span class="pointer-events-none">Install App</span>
            </button>
            <button id="sidebar-import-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L6.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg><span data-lang-key="importLevel" class="pointer-events-none">Import New Level</span></button>`);let a=document.getElementById("header-lang-switcher");a&&(a.innerHTML=F()),document.querySelectorAll(".sidebar-control-group .theme-switch input").forEach(t=>t.addEventListener("change",m)),document.querySelectorAll(".lang-switch button").forEach(t=>t.addEventListener("click",e=>{g(e.currentTarget.dataset.lang)}))}async function ae(){T(),await j(),await W();let a=new URLSearchParams(window.location.search),t=a.get("tab")||l.pinnedTab||(window.innerWidth<=768?"external-search":"hiragana"),e=a.get("level");e&&(l.currentLevel=e);let i=document.getElementById(t),s=document.getElementById("content-loader-template");i&&s&&(document.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active")),i.classList.add("active"),i.innerHTML=s.innerHTML),n.loadingOverlay&&(n.loadingOverlay.style.opacity="0",n.loadingOverlay.addEventListener("transitionend",()=>n.loadingOverlay.classList.add("hidden"),{once:!0}));try{te(),ee(),N(),document.getElementById("sidebar-import-btn")&&import("./modals-ZZIZDEEP.js").then(c=>c.setupImportModal());let o=await H,r=fetch(`${p.dataPath}/levels.json`).then(c=>c.ok?c.json():{levels:[]}).catch(c=>(console.warn("Could not fetch remote levels list. Falling back to default.",c),{levels:[p.defaultLevel]})),K=o.getAllKeys("levels"),[_,L]=await Promise.all([r,K]),y=_.levels||[p.defaultLevel];l.allAvailableLevels=[...new Set([...y,...L])],l.allAvailableLevels.includes(l.currentLevel)||(l.currentLevel=p.defaultLevel,t=l.pinnedTab||(window.innerWidth<=768?"external-search":"hiragana")),await O(l.currentLevel),D(y,L),document.querySelector(`.level-switch-button[data-level-name="${l.currentLevel}"]`)?.classList.add("active"),z(),await q(l.currentLevel),await X(),await w(t,null,!1,!0,!0),b(),g(l.currentLang,!0);let E=document.getElementById("app-version");E&&(E.textContent="v1.0.2");let G={type:"tab",tabName:t,level:l.currentLevel},J=`?level=${l.currentLevel}&tab=${t}`;history.replaceState(G,"",J)}catch(o){console.error("Deferred initialization failed.",o),n.loadingOverlay&&$(u("applicationErrorTitle"),u("applicationErrorBody")+`

Error: ${o.message}`)}}document.addEventListener("DOMContentLoaded",ae);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js?v=1.0.2").then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)},t=>{console.log("ServiceWorker registration failed: ",t)})});
