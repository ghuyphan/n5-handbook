var d={};function la(){d.sidebar=document.getElementById("sidebar"),d.overlay=document.getElementById("overlay"),d.mainContent=document.getElementById("main-content"),d.loadingOverlay=document.getElementById("loading-overlay"),d.levelBadgeDesktop=document.getElementById("level-badge-desktop"),d.levelBadgeMobile=document.getElementById("level-badge-mobile"),d.mobileHeaderTitle=document.getElementById("mobile-header-title"),d.searchInput=document.getElementById("search-input"),d.mobileSearchInput=document.getElementById("mobile-search-input"),d.mobileSearchBar=document.querySelector(".mobile-search-bar"),d.menuToggle=document.getElementById("menu-toggle"),d.pinToggle=document.getElementById("pin-toggle"),d.themeEmoji=document.getElementById("theme-emoji"),d.installAppBtn=document.getElementById("install-app-btn"),d.progressOverview=document.getElementById("progress-overview"),d.progressTab=document.getElementById("progress"),d.hiraganaTab=document.getElementById("hiragana"),d.katakanaTab=document.getElementById("katakana"),d.kanjiTab=document.getElementById("kanji"),d.keyPointsTab=document.getElementById("keyPoints"),d.vocabTab=document.getElementById("vocab"),d.grammarContainer=document.getElementById("grammar-container"),d.grammarTab=document.getElementById("grammar"),d.externalSearchTab=document.getElementById("external-search"),d.sidebarControls=document.getElementById("sidebar-controls"),d.closeSidebarBtn=document.getElementById("close-sidebar-btn"),d.importModal=document.getElementById("import-modal"),d.importModalBackdrop=document.getElementById("import-modal-backdrop"),d.modalWrapper=document.querySelector("#import-modal .modal-wrapper"),d.openModalBtn=document.getElementById("sidebar-import-btn"),d.closeModalBtn=document.getElementById("close-modal-btn"),d.levelNameInput=document.getElementById("level-name-input"),d.levelNameError=document.getElementById("level-name-error"),d.fileImportArea=document.getElementById("file-import-area"),d.fileInput=document.getElementById("file-input"),d.importBtn=document.getElementById("import-btn"),d.desktopNotesBtn=document.getElementById("desktop-notes-btn"),d.mobileNotesBtn=document.getElementById("mobile-notes-btn"),d.notesModal=document.getElementById("notes-modal"),d.notesModalBackdrop=document.getElementById("notes-modal-backdrop"),d.notesModalWrapper=document.querySelector("#notes-modal .modal-wrapper"),d.notesModalTitle=document.getElementById("notes-modal-title"),d.closeNotesModalBtn=document.getElementById("close-notes-modal-btn"),d.notesTextarea=document.getElementById("notes-textarea"),d.notesSaveBtn=document.getElementById("notes-save-btn"),d.notesStatus=document.getElementById("notes-status"),d.kanjiDetailModal=document.getElementById("kanji-detail-modal"),d.kanjiModalBackdrop=document.querySelector("#kanji-detail-modal #kanji-modal-backdrop"),d.kanjiModalContentContainer=document.querySelector("#kanji-detail-modal #modal-content-container"),d.kanjiModalWrapper=document.querySelector("#kanji-detail-modal .modal-wrapper"),d.customDialogContainer=document.getElementById("custom-dialog-container"),d.customDialogBackdrop=document.getElementById("custom-dialog-backdrop"),d.customDialogWrapper=document.querySelector("#custom-dialog-container .modal-wrapper")}var k={defaultLevel:"n5",dataPath:"https://raw.githubusercontent.com/ghuyphan/JLPT_Datas/main"},u={appData:{},progress:{kanji:[],vocab:[]},currentLang:"en",currentLevel:k.defaultLevel,allAvailableLevels:[k.defaultLevel],pinnedTab:null,isSwitchingLevel:!1,loadingStatus:"idle",activeTab:"progress",notes:{data:new Map,originalContent:""},fuseInstances:{},universalFuse:null,currentQuery:"",lastDictionaryQuery:"",tabScrollPositions:new Map,renderedTabs:new Map,openAccordions:new Map,externalDB:{vocab:[],kanji:[],vocabFuse:null,kanjiFuse:null}};function G(e){return e===null?"null":e!==Object(e)?typeof e:{}.toString.call(e).slice(8,-1).toLowerCase()}function D(e){return G(e)!=="string"?!0:!e.length}function Y(e="",t,n){if(D(e))return!1;let r=e.charCodeAt(0);return t<=r&&r<=n}var ht={HIRAGANA:"toHiragana",KATAKANA:"toKatakana"},At={HEPBURN:"hepburn"},xn={useObsoleteKana:!1,passRomaji:!1,convertLongVowelMark:!0,upcaseKatakana:!1,IMEMode:!1,romanization:At.HEPBURN},Cn=65,Sn=90,Tn=65345,Ln=65370,kn=65313,Dn=65338,ke=12353,In=12438,De=12449,Mn=12540,Bn=19968,Nn=40879,jn=12293,On=12540,$n=12539,_n=[65296,65305],Rn=[kn,Dn],Pn=[Tn,Ln],Fn=[65281,65295],Kn=[65306,65311],Hn=[65339,65343],Un=[65371,65376],qn=[65504,65518],Wn=[12352,12447],Jn=[12448,12543],zn=[65382,65439],Vn=[12539,12540],wt=[65377,65381],Gn=[12288,12351],Yn=[19968,40959],Qn=[13312,19903],Zn=[Wn,Jn,wt,zn],Xn=[Gn,wt,Vn,Fn,Kn,Hn,Un,qn],fa=[...Zn,...Xn,Rn,Pn,_n,Yn,Qn],er=[0,127],tr=[[256,257],[274,275],[298,299],[332,333],[362,363]],nr=[[8216,8217],[8220,8221]],rr=[er,...tr],or=[[32,47],[58,63],[91,96],[123,126],...nr];var mt=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function ar(e,t){return!!(e===t||mt(e)&&mt(t))}function sr(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function xt(e,t){t===void 0&&(t=sr);var n=null;function r(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(n&&n.lastThis===this&&t(o,n.lastArgs))return n.lastResult;var s=e.apply(this,o);return n={lastResult:s,lastArgs:o,lastThis:this},s}return r.clear=function(){n=null},r}var gt=Object.prototype.hasOwnProperty;function yt(e,t,n){for(n of e.keys())if(z(n,t))return n}function z(e,t){var n,r,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&z(e[r],t[r]););return r===-1}if(n===Set){if(e.size!==t.size)return!1;for(r of e)if(o=r,o&&typeof o=="object"&&(o=yt(t,o),!o)||!t.has(o))return!1;return!0}if(n===Map){if(e.size!==t.size)return!1;for(r of e)if(o=r[0],o&&typeof o=="object"&&(o=yt(t,o),!o)||!z(r[1],t.get(o)))return!1;return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return r===-1}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return r===-1}if(!n||typeof e=="object"){r=0;for(n in e)if(gt.call(e,n)&&++r&&!gt.call(t,n)||!(n in t)||!z(e[n],t[n]))return!1;return Object.keys(t).length===r}}return e!==e&&t!==t}var pe=(e={})=>Object.assign({},xn,e);function Ct(e,t,n){let r=t;function o(i,c){if(i[c]!==void 0)return Object.assign({"":i[""]+c},i[c])}function a(i,c){let l=i.charAt(0);return s(Object.assign({"":l},r[l]),i.slice(1),c,c+1)}function s(i,c,l,f){if(!c)return n||Object.keys(i).length===1?i[""]?[[l,f,i[""]]]:[]:[[l,f,null]];if(Object.keys(i).length===1)return[[l,f,i[""]]].concat(a(c,f));let p=o(i,c.charAt(0));return p===void 0?[[l,f,i[""]]].concat(a(c,f)):s(p,c.slice(1),l,f+1)}return a(e,0)}function Ie(e){return Object.entries(e).reduce((t,[n,r])=>{let o=G(r)==="string";return t[n]=o?{"":r}:Ie(r),t},{})}function St(e,t){return t.split("").reduce((n,r)=>(n[r]===void 0&&(n[r]={}),n[r]),e)}function Tt(e={}){let t={};return G(e)==="object"&&Object.entries(e).forEach(([n,r])=>{let o=t;n.split("").forEach(a=>{o[a]===void 0&&(o[a]={}),o=o[a]}),o[""]=r}),function(r){let o=JSON.parse(JSON.stringify(r));function a(s,i){return s===void 0||G(s)==="string"?i:Object.entries(i).reduce((c,[l,f])=>(c[l]=a(s[l],f),c),s)}return a(o,t)}}function Lt(e,t){return t?G(t)==="function"?t(e):Tt(t)(e):e}var ir={a:"\u3042",i:"\u3044",u:"\u3046",e:"\u3048",o:"\u304A",k:{a:"\u304B",i:"\u304D",u:"\u304F",e:"\u3051",o:"\u3053"},s:{a:"\u3055",i:"\u3057",u:"\u3059",e:"\u305B",o:"\u305D"},t:{a:"\u305F",i:"\u3061",u:"\u3064",e:"\u3066",o:"\u3068"},n:{a:"\u306A",i:"\u306B",u:"\u306C",e:"\u306D",o:"\u306E"},h:{a:"\u306F",i:"\u3072",u:"\u3075",e:"\u3078",o:"\u307B"},m:{a:"\u307E",i:"\u307F",u:"\u3080",e:"\u3081",o:"\u3082"},y:{a:"\u3084",u:"\u3086",o:"\u3088"},r:{a:"\u3089",i:"\u308A",u:"\u308B",e:"\u308C",o:"\u308D"},w:{a:"\u308F",i:"\u3090",e:"\u3091",o:"\u3092"},g:{a:"\u304C",i:"\u304E",u:"\u3050",e:"\u3052",o:"\u3054"},z:{a:"\u3056",i:"\u3058",u:"\u305A",e:"\u305C",o:"\u305E"},d:{a:"\u3060",i:"\u3062",u:"\u3065",e:"\u3067",o:"\u3069"},b:{a:"\u3070",i:"\u3073",u:"\u3076",e:"\u3079",o:"\u307C"},p:{a:"\u3071",i:"\u3074",u:"\u3077",e:"\u307A",o:"\u307D"},v:{a:"\u3094\u3041",i:"\u3094\u3043",u:"\u3094",e:"\u3094\u3047",o:"\u3094\u3049"}},cr={".":"\u3002",",":"\u3001",":":"\uFF1A","/":"\u30FB","!":"\uFF01","?":"\uFF1F","~":"\u301C","-":"\u30FC","\u2018":"\u300C","\u2019":"\u300D","\u201C":"\u300E","\u201D":"\u300F","[":"\uFF3B","]":"\uFF3D","(":"\uFF08",")":"\uFF09","{":"\uFF5B","}":"\uFF5D"},vt={k:"\u304D",s:"\u3057",t:"\u3061",n:"\u306B",h:"\u3072",m:"\u307F",r:"\u308A",g:"\u304E",z:"\u3058",d:"\u3062",b:"\u3073",p:"\u3074",v:"\u3094",q:"\u304F",f:"\u3075"},kt={ya:"\u3083",yi:"\u3043",yu:"\u3085",ye:"\u3047",yo:"\u3087"},Dt={a:"\u3041",i:"\u3043",u:"\u3045",e:"\u3047",o:"\u3049"},Et={sh:"sy",ch:"ty",cy:"ty",chy:"ty",shy:"sy",j:"zy",jy:"zy",shi:"si",chi:"ti",tsu:"tu",ji:"zi",fu:"hu"},lr=Object.assign({tu:"\u3063",wa:"\u308E",ka:"\u30F5",ke:"\u30F6"},Dt,kt),ur={yi:"\u3044",wu:"\u3046",ye:"\u3044\u3047",wi:"\u3046\u3043",we:"\u3046\u3047",kwa:"\u304F\u3041",whu:"\u3046",tha:"\u3066\u3083",thu:"\u3066\u3085",tho:"\u3066\u3087",dha:"\u3067\u3083",dhu:"\u3067\u3085",dho:"\u3067\u3087"},dr={wh:"\u3046",kw:"\u304F",qw:"\u304F",q:"\u304F",gw:"\u3050",sw:"\u3059",ts:"\u3064",th:"\u3066",tw:"\u3068",dh:"\u3067",dw:"\u3069",fw:"\u3075",f:"\u3075"};function fr(){let e=Ie(ir),t=o=>St(e,o);Object.entries(vt).forEach(([o,a])=>{Object.entries(kt).forEach(([s,i])=>{t(o+s)[""]=a+i})}),Object.entries(cr).forEach(([o,a])=>{t(o)[""]=a}),Object.entries(dr).forEach(([o,a])=>{Object.entries(Dt).forEach(([s,i])=>{let c=t(o+s);c[""]=a+i})}),["n","n'","xn"].forEach(o=>{t(o)[""]="\u3093"}),e.c=JSON.parse(JSON.stringify(e.k)),Object.entries(Et).forEach(([o,a])=>{let s=o.slice(0,o.length-1),i=o.charAt(o.length-1),c=t(s);c[i]=JSON.parse(JSON.stringify(t(a)))});function n(o){return[...Object.entries(Et),["c","k"]].reduce((a,[s,i])=>o.startsWith(i)?a.concat(o.replace(i,s)):a,[])}Object.entries(lr).forEach(([o,a])=>{let s=p=>p.charAt(p.length-1),i=p=>p.slice(0,p.length-1),c=`x${o}`,l=t(c);l[""]=a;let f=t(`l${i(o)}`);f[s(o)]=l,n(o).forEach(p=>{["l","x"].forEach(h=>{let m=t(h+i(p));m[s(p)]=t(h+o)})})}),Object.entries(ur).forEach(([o,a])=>{t(o)[""]=a});function r(o){return Object.entries(o).reduce((a,[s,i])=>(s?a[s]=r(i):a[s]=`\u3063${i}`,a),{})}return[...Object.keys(vt),"c","y","w","j"].forEach(o=>{let a=e[o];a[o]=r(a)}),delete e.n.n,Object.freeze(JSON.parse(JSON.stringify(e)))}var Ce=null;function pr(){return Ce==null&&(Ce=fr()),Ce}var hr=Tt({wi:"\u3090",we:"\u3091"});function mr(e){let t=JSON.parse(JSON.stringify(e));return t.n.n={"":"\u3093"},t.n[" "]={"":"\u3093"},t}function gr(e=""){return D(e)?!1:Y(e,Cn,Sn)}function X(e=""){return D(e)?!1:e.charCodeAt(0)===On}function It(e=""){return D(e)?!1:e.charCodeAt(0)===$n}function Me(e=""){return D(e)?!1:X(e)?!0:Y(e,ke,In)}function ue(e=""){let t=[];return e.split("").forEach(n=>{if(X(n)||It(n))t.push(n);else if(Me(n)){let r=n.charCodeAt(0)+(De-ke),o=String.fromCharCode(r);t.push(o)}else t.push(n)}),t.join("")}var Mt=xt((e,t,n)=>{let r=pr();return r=e?mr(r):r,r=t?hr(r):r,n&&(r=Lt(r,n)),r},z);function Le(e="",t={},n){let r;return n?r=t:(r=pe(t),n=Mt(r.IMEMode,r.useObsoleteKana,r.customKanaMapping)),yr(e,r,n).map(o=>{let[a,s,i]=o;if(i===null)return e.slice(a);let c=r.IMEMode===ht.HIRAGANA,l=r.IMEMode===ht.KATAKANA||[...e.slice(a,s)].every(gr);return c||!l?i:ue(i)}).join("")}function yr(e="",t={},n){let{IMEMode:r,useObsoleteKana:o,customKanaMapping:a}=t;return n||(n=Mt(r,o,a)),Ct(e.toLowerCase(),n,!r)}function vr(e=""){return D(e)?!1:rr.some(([t,n])=>Y(e,t,n))}function ee(e="",t){let n=G(t)==="regexp";return D(e)?!1:[...e].every(r=>{let o=vr(r);return n?o||t.test(r):o})}function fe(e=""){return Y(e,De,Mn)}function Er(e=""){return D(e)?!1:Me(e)||fe(e)}function Bt(e=""){return D(e)?!1:[...e].every(Er)}function br(e=""){return D(e)?!1:[...e].every(Me)}function Nt(e=""){return D(e)?!1:[...e].every(fe)}function Ar(e=""){return D(e)?!1:e.charCodeAt(0)===jn}function wr(e=""){return Y(e,Bn,Nn)||Ar(e)}function xr(e=""){return D(e)?!1:[...e].every(wr)}function jt(e="",t={passKanji:!0}){let n=[...e],r=!1;return t.passKanji||(r=n.some(xr)),(n.some(br)||n.some(Nt))&&n.some(ee)&&!r}var Cr=(e,t)=>X(e)&&t<1,Sr=(e,t)=>X(e)&&t>0,Tr=e=>["\u30F6","\u30F5"].includes(e),Lr={a:"\u3042",i:"\u3044",u:"\u3046",e:"\u3048",o:"\u3046"};function de(e="",t,{isDestinationRomaji:n,convertLongVowelMark:r}={}){let o="";return e.split("").reduce((a,s,i)=>{if(It(s)||Cr(s,i)||Tr(s))return a.concat(s);if(r&&o&&Sr(s,i)){let c=t(o).slice(-1);return fe(e[i-1])&&c==="o"&&n?a.concat("\u304A"):a.concat(Lr[c])}if(!X(s)&&fe(s)){let c=s.charCodeAt(0)+(ke-De),l=String.fromCharCode(c);return o=l,a.concat(l)}return o="",a.concat(s)},[]).join("")}var Se=null,kr={\u3042:"a",\u3044:"i",\u3046:"u",\u3048:"e",\u304A:"o",\u304B:"ka",\u304D:"ki",\u304F:"ku",\u3051:"ke",\u3053:"ko",\u3055:"sa",\u3057:"shi",\u3059:"su",\u305B:"se",\u305D:"so",\u305F:"ta",\u3061:"chi",\u3064:"tsu",\u3066:"te",\u3068:"to",\u306A:"na",\u306B:"ni",\u306C:"nu",\u306D:"ne",\u306E:"no",\u306F:"ha",\u3072:"hi",\u3075:"fu",\u3078:"he",\u307B:"ho",\u307E:"ma",\u307F:"mi",\u3080:"mu",\u3081:"me",\u3082:"mo",\u3089:"ra",\u308A:"ri",\u308B:"ru",\u308C:"re",\u308D:"ro",\u3084:"ya",\u3086:"yu",\u3088:"yo",\u308F:"wa",\u3090:"wi",\u3091:"we",\u3092:"wo",\u3093:"n",\u304C:"ga",\u304E:"gi",\u3050:"gu",\u3052:"ge",\u3054:"go",\u3056:"za",\u3058:"ji",\u305A:"zu",\u305C:"ze",\u305E:"zo",\u3060:"da",\u3062:"ji",\u3065:"zu",\u3067:"de",\u3069:"do",\u3070:"ba",\u3073:"bi",\u3076:"bu",\u3079:"be",\u307C:"bo",\u3071:"pa",\u3074:"pi",\u3077:"pu",\u307A:"pe",\u307D:"po",\u3094\u3041:"va",\u3094\u3043:"vi",\u3094:"vu",\u3094\u3047:"ve",\u3094\u3049:"vo"},Dr={"\u3002":".","\u3001":",","\uFF1A":":","\u30FB":"/","\uFF01":"!","\uFF1F":"?","\u301C":"~",\u30FC:"-","\u300C":"\u2018","\u300D":"\u2019","\u300E":"\u201C","\u300F":"\u201D","\uFF3B":"[","\uFF3D":"]","\uFF08":"(","\uFF09":")","\uFF5B":"{","\uFF5D":"}","\u3000":" "},Ir=["\u3042","\u3044","\u3046","\u3048","\u304A","\u3084","\u3086","\u3088"],Te={\u3083:"ya",\u3085:"yu",\u3087:"yo"},Mr={\u3043:"yi",\u3047:"ye"},Br={\u3041:"a",\u3043:"i",\u3045:"u",\u3047:"e",\u3049:"o"},Nr=["\u304D","\u306B","\u3072","\u307F","\u308A","\u304E","\u3073","\u3074","\u3094","\u304F","\u3075"],jr={\u3057:"sh",\u3061:"ch",\u3058:"j",\u3062:"j"},Or={\u3063:"",\u3083:"ya",\u3085:"yu",\u3087:"yo",\u3041:"a",\u3043:"i",\u3045:"u",\u3047:"e",\u3049:"o"},bt={b:"b",c:"t",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",m:"m",p:"p",q:"q",r:"r",s:"s",t:"t",v:"v",w:"w",x:"x",z:"z"};function $r(){return Se==null&&(Se=Rr()),Se}function _r(e){switch(e){case At.HEPBURN:return $r();default:return{}}}function Rr(){let e=Ie(kr),t=r=>St(e,r),n=(r,o)=>{t(r)[""]=o};return Object.entries(Dr).forEach(([r,o])=>{t(r)[""]=o}),[...Object.entries(Te),...Object.entries(Br)].forEach(([r,o])=>{n(r,o)}),Nr.forEach(r=>{let o=t(r)[""][0];Object.entries(Te).forEach(([a,s])=>{n(r+a,o+s)}),Object.entries(Mr).forEach(([a,s])=>{n(r+a,o+s)})}),Object.entries(jr).forEach(([r,o])=>{Object.entries(Te).forEach(([a,s])=>{n(r+a,o+s[1])}),n(`${r}\u3043`,`${o}yi`),n(`${r}\u3047`,`${o}e`)}),e.\u3063=Ot(e),Object.entries(Or).forEach(([r,o])=>{n(r,o)}),Ir.forEach(r=>{n(`\u3093${r}`,`n'${t(r)[""]}`)}),Object.freeze(JSON.parse(JSON.stringify(e)))}function Ot(e){return Object.entries(e).reduce((t,[n,r])=>{if(n)t[n]=Ot(r);else{let o=r.charAt(0);t[n]=Object.keys(bt).includes(o)?bt[o]+r:r}return t},{})}var $t=xt((e,t)=>{let n=_r(e);return t&&(n=Lt(n,t)),n},z);function V(e="",t={},n){let r=pe(t);return n||(n=$t(r.romanization,r.customRomajiMapping)),Pr(e,r,n).map(o=>{let[a,s,i]=o;return r.upcaseKatakana&&Nt(e.slice(a,s))?i.toUpperCase():i}).join("")}function Pr(e,t,n){n||(n=$t(t.romanization,t.customRomajiMapping));let r=Object.assign({},{isDestinationRomaji:!0},t);return Ct(de(e,V,r),n,!t.IMEMode)}function _t(e=""){return D(e)?!1:or.some(([t,n])=>Y(e,t,n))}function Rt(e="",t={}){let n=pe(t);if(n.passRomaji)return de(e,V,n);if(jt(e,{passKanji:!0})){let r=de(e,V,n);return Le(r.toLowerCase(),n)}return ee(e)||_t(e)?Le(e.toLowerCase(),n):de(e,V,n)}function Pt(e="",t={}){let n=pe(t);if(n.passRomaji)return ue(e);if(jt(e)||ee(e)||_t(e)){let r=Le(e.toLowerCase(),n);return ue(r)}return ue(e)}var he=(e,t)=>{let n,r=(...o)=>{let a=()=>{clearTimeout(n),e.apply(void 0,o)};clearTimeout(n),n=setTimeout(a,t)};return r.cancel=()=>clearTimeout(n),r},j=(e=[])=>{let t=new Set;return e.filter(Boolean).forEach(n=>{let r=String(n).toLowerCase();t.add(r),Bt(r)&&t.add(V(r)),ee(r)&&(t.add(Rt(r)),t.add(Pt(r)))}),Array.from(t).join(" ")},ha=(e,t={})=>{let n=u.appData.ui?.[u.currentLang]?.[e]||u.appData.ui?.en?.[e]||`[${e}]`;e==="lastSavedOn"&&!u.appData.ui?.[u.currentLang]?.[e]&&(n="Last saved: {date}");for(let[r,o]of Object.entries(t))n=n.replace(`{${r}}`,o);return n};function _(e){return Array.isArray?Array.isArray(e):zt(e)==="[object Array]"}var Kr=1/0;function Hr(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-Kr?"-0":t}function Ur(e){return e==null?"":Hr(e)}function O(e){return typeof e=="string"}function Wt(e){return typeof e=="number"}function qr(e){return e===!0||e===!1||Wr(e)&&zt(e)=="[object Boolean]"}function Jt(e){return typeof e=="object"}function Wr(e){return Jt(e)&&e!==null}function M(e){return e!=null}function Be(e){return!e.trim().length}function zt(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var Jr="Incorrect 'index' type",zr=e=>`Invalid value for key ${e}`,Vr=e=>`Pattern length exceeds max of ${e}.`,Gr=e=>`Missing ${e} property in key`,Yr=e=>`Property 'weight' in key '${e}' must be a positive integer`,Ft=Object.prototype.hasOwnProperty,Ne=class{constructor(t){this._keys=[],this._keyMap={};let n=0;t.forEach(r=>{let o=Vt(r);this._keys.push(o),this._keyMap[o.id]=o,n+=o.weight}),this._keys.forEach(r=>{r.weight/=n})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function Vt(e){let t=null,n=null,r=null,o=1,a=null;if(O(e)||_(e))r=e,t=Kt(e),n=je(e);else{if(!Ft.call(e,"name"))throw new Error(Gr("name"));let s=e.name;if(r=s,Ft.call(e,"weight")&&(o=e.weight,o<=0))throw new Error(Yr(s));t=Kt(s),n=je(s),a=e.getFn}return{path:t,id:n,weight:o,src:r,getFn:a}}function Kt(e){return _(e)?e:e.split(".")}function je(e){return _(e)?e.join("."):e}function Qr(e,t){let n=[],r=!1,o=(a,s,i)=>{if(M(a))if(!s[i])n.push(a);else{let c=s[i],l=a[c];if(!M(l))return;if(i===s.length-1&&(O(l)||Wt(l)||qr(l)))n.push(Ur(l));else if(_(l)){r=!0;for(let f=0,p=l.length;f<p;f+=1)o(l[f],s,i+1)}else s.length&&o(l,s,i+1)}};return o(e,O(t)?t.split("."):t,0),r?n:n[0]}var Zr={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Xr={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},eo={location:0,threshold:.6,distance:100},to={useExtendedSearch:!1,getFn:Qr,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},y={...Xr,...Zr,...eo,...to},no=/[^ ]+/g;function ro(e=1,t=3){let n=new Map,r=Math.pow(10,t);return{get(o){let a=o.match(no).length;if(n.has(a))return n.get(a);let s=1/Math.pow(a,.5*e),i=parseFloat(Math.round(s*r)/r);return n.set(a,i),i},clear(){n.clear()}}}var te=class{constructor({getFn:t=y.getFn,fieldNormWeight:n=y.fieldNormWeight}={}){this.norm=ro(n,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((n,r)=>{this._keysMap[n.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,O(this.docs[0])?this.docs.forEach((t,n)=>{this._addString(t,n)}):this.docs.forEach((t,n)=>{this._addObject(t,n)}),this.norm.clear())}add(t){let n=this.size();O(t)?this._addString(t,n):this._addObject(t,n)}removeAt(t){this.records.splice(t,1);for(let n=t,r=this.size();n<r;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(t,n){return t[this._keysMap[n]]}size(){return this.records.length}_addString(t,n){if(!M(t)||Be(t))return;let r={v:t,i:n,n:this.norm.get(t)};this.records.push(r)}_addObject(t,n){let r={i:n,$:{}};this.keys.forEach((o,a)=>{let s=o.getFn?o.getFn(t):this.getFn(t,o.path);if(M(s)){if(_(s)){let i=[],c=[{nestedArrIndex:-1,value:s}];for(;c.length;){let{nestedArrIndex:l,value:f}=c.pop();if(M(f))if(O(f)&&!Be(f)){let p={v:f,i:l,n:this.norm.get(f)};i.push(p)}else _(f)&&f.forEach((p,h)=>{c.push({nestedArrIndex:h,value:p})})}r.$[a]=i}else if(O(s)&&!Be(s)){let i={v:s,n:this.norm.get(s)};r.$[a]=i}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}};function Gt(e,t,{getFn:n=y.getFn,fieldNormWeight:r=y.fieldNormWeight}={}){let o=new te({getFn:n,fieldNormWeight:r});return o.setKeys(e.map(Vt)),o.setSources(t),o.create(),o}function oo(e,{getFn:t=y.getFn,fieldNormWeight:n=y.fieldNormWeight}={}){let{keys:r,records:o}=e,a=new te({getFn:t,fieldNormWeight:n});return a.setKeys(r),a.setIndexRecords(o),a}function me(e,{errors:t=0,currentLocation:n=0,expectedLocation:r=0,distance:o=y.distance,ignoreLocation:a=y.ignoreLocation}={}){let s=t/e.length;if(a)return s;let i=Math.abs(r-n);return o?s+i/o:i?1:s}function ao(e=[],t=y.minMatchCharLength){let n=[],r=-1,o=-1,a=0;for(let s=e.length;a<s;a+=1){let i=e[a];i&&r===-1?r=a:!i&&r!==-1&&(o=a-1,o-r+1>=t&&n.push([r,o]),r=-1)}return e[a-1]&&a-r>=t&&n.push([r,a-1]),n}var H=32;function so(e,t,n,{location:r=y.location,distance:o=y.distance,threshold:a=y.threshold,findAllMatches:s=y.findAllMatches,minMatchCharLength:i=y.minMatchCharLength,includeMatches:c=y.includeMatches,ignoreLocation:l=y.ignoreLocation}={}){if(t.length>H)throw new Error(Vr(H));let f=t.length,p=e.length,h=Math.max(0,Math.min(r,p)),m=a,v=h,E=i>1||c,g=E?Array(p):[],b;for(;(b=e.indexOf(t,v))>-1;){let T=me(t,{currentLocation:b,expectedLocation:h,distance:o,ignoreLocation:l});if(m=Math.min(T,m),v=b+f,E){let L=0;for(;L<f;)g[b+L]=1,L+=1}}v=-1;let x=[],A=1,S=f+p,F=1<<f-1;for(let T=0;T<f;T+=1){let L=0,C=S;for(;L<C;)me(t,{errors:T,currentLocation:h+C,expectedLocation:h,distance:o,ignoreLocation:l})<=m?L=C:S=C,C=Math.floor((S-L)/2+L);S=C;let ie=Math.max(1,h-C+1),J=s?p:Math.min(h+C,p)+f,P=Array(J+2);P[J+1]=(1<<T)-1;for(let B=J;B>=ie;B-=1){let le=B-1,pt=n[e.charAt(le)];if(E&&(g[le]=+!!pt),P[B]=(P[B+1]<<1|1)&pt,T&&(P[B]|=(x[B+1]|x[B])<<1|1|x[B+1]),P[B]&F&&(A=me(t,{errors:T,currentLocation:le,expectedLocation:h,distance:o,ignoreLocation:l}),A<=m)){if(m=A,v=le,v<=h)break;ie=Math.max(1,2*h-v)}}if(me(t,{errors:T+1,currentLocation:h,expectedLocation:h,distance:o,ignoreLocation:l})>m)break;x=P}let K={isMatch:v>=0,score:Math.max(.001,A)};if(E){let T=ao(g,i);T.length?c&&(K.indices=T):K.isMatch=!1}return K}function io(e){let t={};for(let n=0,r=e.length;n<r;n+=1){let o=e.charAt(n);t[o]=(t[o]||0)|1<<r-n-1}return t}var ge=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e,ye=class{constructor(t,{location:n=y.location,threshold:r=y.threshold,distance:o=y.distance,includeMatches:a=y.includeMatches,findAllMatches:s=y.findAllMatches,minMatchCharLength:i=y.minMatchCharLength,isCaseSensitive:c=y.isCaseSensitive,ignoreDiacritics:l=y.ignoreDiacritics,ignoreLocation:f=y.ignoreLocation}={}){if(this.options={location:n,threshold:r,distance:o,includeMatches:a,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:f},t=c?t:t.toLowerCase(),t=l?ge(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;let p=(m,v)=>{this.chunks.push({pattern:m,alphabet:io(m),startIndex:v})},h=this.pattern.length;if(h>H){let m=0,v=h%H,E=h-v;for(;m<E;)p(this.pattern.substr(m,H),m),m+=H;if(v){let g=h-H;p(this.pattern.substr(g),g)}}else p(this.pattern,0)}searchIn(t){let{isCaseSensitive:n,ignoreDiacritics:r,includeMatches:o}=this.options;if(t=n?t:t.toLowerCase(),t=r?ge(t):t,this.pattern===t){let E={isMatch:!0,score:0};return o&&(E.indices=[[0,t.length-1]]),E}let{location:a,distance:s,threshold:i,findAllMatches:c,minMatchCharLength:l,ignoreLocation:f}=this.options,p=[],h=0,m=!1;this.chunks.forEach(({pattern:E,alphabet:g,startIndex:b})=>{let{isMatch:x,score:A,indices:S}=so(t,E,g,{location:a+b,distance:s,threshold:i,findAllMatches:c,minMatchCharLength:l,includeMatches:o,ignoreLocation:f});x&&(m=!0),h+=A,x&&S&&(p=[...p,...S])});let v={isMatch:m,score:m?h/this.chunks.length:1};return m&&o&&(v.indices=p),v}},$=class{constructor(t){this.pattern=t}static isMultiMatch(t){return Ht(t,this.multiRegex)}static isSingleMatch(t){return Ht(t,this.singleRegex)}search(){}};function Ht(e,t){let n=e.match(t);return n?n[1]:null}var Oe=class extends ${constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){let n=t===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},$e=class extends ${constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){let r=t.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}},_e=class extends ${constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){let n=t.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},Re=class extends ${constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){let n=!t.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}},Pe=class extends ${constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){let n=t.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[t.length-this.pattern.length,t.length-1]}}},Fe=class extends ${constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){let n=!t.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}},ve=class extends ${constructor(t,{location:n=y.location,threshold:r=y.threshold,distance:o=y.distance,includeMatches:a=y.includeMatches,findAllMatches:s=y.findAllMatches,minMatchCharLength:i=y.minMatchCharLength,isCaseSensitive:c=y.isCaseSensitive,ignoreDiacritics:l=y.ignoreDiacritics,ignoreLocation:f=y.ignoreLocation}={}){super(t),this._bitapSearch=new ye(t,{location:n,threshold:r,distance:o,includeMatches:a,findAllMatches:s,minMatchCharLength:i,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:f})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}},Ee=class extends ${constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let n=0,r,o=[],a=this.pattern.length;for(;(r=t.indexOf(this.pattern,n))>-1;)n=r+a,o.push([r,n-1]);let s=!!o.length;return{isMatch:s,score:s?0:1,indices:o}}},Ke=[Oe,Ee,_e,Re,Fe,Pe,$e,ve],Ut=Ke.length,co=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,lo="|";function uo(e,t={}){return e.split(lo).map(n=>{let r=n.trim().split(co).filter(a=>a&&!!a.trim()),o=[];for(let a=0,s=r.length;a<s;a+=1){let i=r[a],c=!1,l=-1;for(;!c&&++l<Ut;){let f=Ke[l],p=f.isMultiMatch(i);p&&(o.push(new f(p,t)),c=!0)}if(!c)for(l=-1;++l<Ut;){let f=Ke[l],p=f.isSingleMatch(i);if(p){o.push(new f(p,t));break}}}return o})}var fo=new Set([ve.type,Ee.type]),He=class{constructor(t,{isCaseSensitive:n=y.isCaseSensitive,ignoreDiacritics:r=y.ignoreDiacritics,includeMatches:o=y.includeMatches,minMatchCharLength:a=y.minMatchCharLength,ignoreLocation:s=y.ignoreLocation,findAllMatches:i=y.findAllMatches,location:c=y.location,threshold:l=y.threshold,distance:f=y.distance}={}){this.query=null,this.options={isCaseSensitive:n,ignoreDiacritics:r,includeMatches:o,minMatchCharLength:a,findAllMatches:i,ignoreLocation:s,location:c,threshold:l,distance:f},t=n?t:t.toLowerCase(),t=r?ge(t):t,this.pattern=t,this.query=uo(this.pattern,this.options)}static condition(t,n){return n.useExtendedSearch}searchIn(t){let n=this.query;if(!n)return{isMatch:!1,score:1};let{includeMatches:r,isCaseSensitive:o,ignoreDiacritics:a}=this.options;t=o?t:t.toLowerCase(),t=a?ge(t):t;let s=0,i=[],c=0;for(let l=0,f=n.length;l<f;l+=1){let p=n[l];i.length=0,s=0;for(let h=0,m=p.length;h<m;h+=1){let v=p[h],{isMatch:E,indices:g,score:b}=v.search(t);if(E){if(s+=1,c+=b,r){let x=v.constructor.type;fo.has(x)?i=[...i,...g]:i.push(g)}}else{c=0,s=0,i.length=0;break}}if(s){let h={isMatch:!0,score:c/s};return r&&(h.indices=i),h}}return{isMatch:!1,score:1}}},Ue=[];function po(...e){Ue.push(...e)}function qe(e,t){for(let n=0,r=Ue.length;n<r;n+=1){let o=Ue[n];if(o.condition(e,t))return new o(e,t)}return new ye(e,t)}var be={AND:"$and",OR:"$or"},We={PATH:"$path",PATTERN:"$val"},Je=e=>!!(e[be.AND]||e[be.OR]),ho=e=>!!e[We.PATH],mo=e=>!_(e)&&Jt(e)&&!Je(e),qt=e=>({[be.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Yt(e,t,{auto:n=!0}={}){let r=o=>{let a=Object.keys(o),s=ho(o);if(!s&&a.length>1&&!Je(o))return r(qt(o));if(mo(o)){let c=s?o[We.PATH]:a[0],l=s?o[We.PATTERN]:o[c];if(!O(l))throw new Error(zr(c));let f={keyId:je(c),pattern:l};return n&&(f.searcher=qe(l,t)),f}let i={children:[],operator:a[0]};return a.forEach(c=>{let l=o[c];_(l)&&l.forEach(f=>{i.children.push(r(f))})}),i};return Je(e)||(e=qt(e)),r(e)}function go(e,{ignoreFieldNorm:t=y.ignoreFieldNorm}){e.forEach(n=>{let r=1;n.matches.forEach(({key:o,norm:a,score:s})=>{let i=o?o.weight:null;r*=Math.pow(s===0&&i?Number.EPSILON:s,(i||1)*(t?1:a))}),n.score=r})}function yo(e,t){let n=e.matches;t.matches=[],M(n)&&n.forEach(r=>{if(!M(r.indices)||!r.indices.length)return;let{indices:o,value:a}=r,s={indices:o,value:a};r.key&&(s.key=r.key.src),r.idx>-1&&(s.refIndex=r.idx),t.matches.push(s)})}function vo(e,t){t.score=e.score}function Eo(e,t,{includeMatches:n=y.includeMatches,includeScore:r=y.includeScore}={}){let o=[];return n&&o.push(yo),r&&o.push(vo),e.map(a=>{let{idx:s}=a,i={item:t[s],refIndex:s};return o.length&&o.forEach(c=>{c(a,i)}),i})}var R=class{constructor(t,n={},r){this.options={...y,...n},this.options.useExtendedSearch,this._keyStore=new Ne(this.options.keys),this.setCollection(t,r)}setCollection(t,n){if(this._docs=t,n&&!(n instanceof te))throw new Error(Jr);this._myIndex=n||Gt(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){M(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){let n=[];for(let r=0,o=this._docs.length;r<o;r+=1){let a=this._docs[r];t(a,r)&&(this.removeAt(r),r-=1,o-=1,n.push(a))}return n}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:n=-1}={}){let{includeMatches:r,includeScore:o,shouldSort:a,sortFn:s,ignoreFieldNorm:i}=this.options,c=O(t)?O(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return go(c,{ignoreFieldNorm:i}),a&&c.sort(s),Wt(n)&&n>-1&&(c=c.slice(0,n)),Eo(c,this._docs,{includeMatches:r,includeScore:o})}_searchStringList(t){let n=qe(t,this.options),{records:r}=this._myIndex,o=[];return r.forEach(({v:a,i:s,n:i})=>{if(!M(a))return;let{isMatch:c,score:l,indices:f}=n.searchIn(a);c&&o.push({item:a,idx:s,matches:[{score:l,value:a,norm:i,indices:f}]})}),o}_searchLogical(t){let n=Yt(t,this.options),r=(i,c,l)=>{if(!i.children){let{keyId:p,searcher:h}=i,m=this._findMatches({key:this._keyStore.get(p),value:this._myIndex.getValueForItemAtKeyId(c,p),searcher:h});return m&&m.length?[{idx:l,item:c,matches:m}]:[]}let f=[];for(let p=0,h=i.children.length;p<h;p+=1){let m=i.children[p],v=r(m,c,l);if(v.length)f.push(...v);else if(i.operator===be.AND)return[]}return f},o=this._myIndex.records,a={},s=[];return o.forEach(({$:i,i:c})=>{if(M(i)){let l=r(n,i,c);l.length&&(a[c]||(a[c]={idx:c,item:i,matches:[]},s.push(a[c])),l.forEach(({matches:f})=>{a[c].matches.push(...f)}))}}),s}_searchObjectList(t){let n=qe(t,this.options),{keys:r,records:o}=this._myIndex,a=[];return o.forEach(({$:s,i})=>{if(!M(s))return;let c=[];r.forEach((l,f)=>{c.push(...this._findMatches({key:l,value:s[f],searcher:n}))}),c.length&&a.push({idx:i,item:s,matches:c})}),a}_findMatches({key:t,value:n,searcher:r}){if(!M(n))return[];let o=[];if(_(n))n.forEach(({v:a,i:s,n:i})=>{if(!M(a))return;let{isMatch:c,score:l,indices:f}=r.searchIn(a);c&&o.push({score:l,key:t,value:a,idx:s,norm:i,indices:f})});else{let{v:a,n:s}=n,{isMatch:i,score:c,indices:l}=r.searchIn(a);i&&o.push({score:c,key:t,value:a,norm:s,indices:l})}return o}};R.version="7.1.0";R.createIndex=Gt;R.parseIndex=oo;R.config=y;R.parseQuery=Yt;po(He);var Ge=(e,t)=>t.some(n=>e instanceof n),Qt,Zt;function bo(){return Qt||(Qt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ao(){return Zt||(Zt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Ye=new WeakMap,ze=new WeakMap,Ae=new WeakMap;function wo(e){let t=new Promise((n,r)=>{let o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(U(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",s)});return Ae.set(t,e),t}function xo(e){if(Ye.has(e))return;let t=new Promise((n,r)=>{let o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});Ye.set(e,t)}var Qe={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Ye.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return U(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function nn(e){Qe=e(Qe)}function Co(e){return Ao().includes(e)?function(...t){return e.apply(Ze(this),t),U(this.request)}:function(...t){return U(e.apply(Ze(this),t))}}function So(e){return typeof e=="function"?Co(e):(e instanceof IDBTransaction&&xo(e),Ge(e,bo())?new Proxy(e,Qe):e)}function U(e){if(e instanceof IDBRequest)return wo(e);if(ze.has(e))return ze.get(e);let t=So(e);return t!==e&&(ze.set(e,t),Ae.set(t,e)),t}var Ze=e=>Ae.get(e);function rn(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){let s=indexedDB.open(e,t),i=U(s);return r&&s.addEventListener("upgradeneeded",c=>{r(U(s.result),c.oldVersion,c.newVersion,U(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),i.then(c=>{a&&c.addEventListener("close",()=>a()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),i}var To=["get","getKey","getAll","getAllKeys","count"],Lo=["put","add","delete","clear"],Ve=new Map;function Xt(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Ve.get(t))return Ve.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,o=Lo.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||To.includes(n)))return;let a=async function(s,...i){let c=this.transaction(s,o?"readwrite":"readonly"),l=c.store;return r&&(l=l.index(i.shift())),(await Promise.all([l[n](...i),o&&c.done]))[0]};return Ve.set(t,a),a}nn(e=>({...e,get:(t,n,r)=>Xt(t,n)||e.get(t,n,r),has:(t,n)=>!!Xt(t,n)||e.has(t,n)}));var ko=["continue","continuePrimaryKey","advance"],en={},Xe=new WeakMap,on=new WeakMap,Do={get(e,t){if(!ko.includes(t))return e[t];let n=en[t];return n||(n=en[t]=function(...r){Xe.set(this,on.get(this)[t](...r))}),n}};async function*Io(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let n=new Proxy(t,Do);for(on.set(n,t),Ae.set(n,Ze(t));t;)yield n,t=await(Xe.get(n)||t.continue()),Xe.delete(n)}function tn(e,t){return t===Symbol.asyncIterator&&Ge(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Ge(e,[IDBIndex,IDBObjectStore])}nn(e=>({...e,get(t,n,r){return tn(t,n)?Io:e.get(t,n,r)},has(t,n){return tn(t,n)||e.has(t,n)}}));var W=new Map;function Mo(e,t){e.forEach(n=>{if(!n.isIntersecting)return;let r=n.target,o=r.parentElement,a=o.closest(".tab-content")?.id;if(!a||!W.has(a))return;let{allItems:s,createFn:i,batchSize:c,currentIndex:l}=W.get(a),f=Math.min(l+c,s.length);if(l>=s.length){r.remove(),t.disconnect();return}let p=document.createDocumentFragment();for(let h=l;h<f;h++)p.appendChild(i(s[h]));o.insertBefore(p,r),W.set(a,{allItems:s,createFn:i,batchSize:c,currentIndex:f})})}function I(e,t){if(!e)return"";let n=t?e[t]:e;return n&&typeof n=="object"&&!Array.isArray(n)?n[u.currentLang]||n.en||"":n||""}function Bo(e,t=""){let n=o=>u.appData.ui?.[u.currentLang]?.[o]||`[${o}]`,r="";switch(e){case"searching":r='<div class="loader"></div>';break;case"no-results":let o='<svg class="w-16 h-16 text-secondary opacity-50 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>',a=`${n("noResults")} "<b class="text-accent-teal">${t}</b>"`,s=n("noResultsSubtitle");r=`
                ${o}
                <h3 class="text-xl font-semibold text-primary">${a}</h3>
                <p class="text-secondary text-base mt-1 max-w-md">${s}</p>
            `;break;case"error":let i='<svg class="w-16 h-16 text-accent-red opacity-60 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>',c=n("searchErrorTitle"),l=n("searchError");r=`
                ${i}
                <h3 class="text-xl font-semibold text-primary">${c}</h3>
                <p class="text-secondary text-base mt-1 max-w-md">${l}</p>
                <button data-action="retry-search" data-query="${t}">${n("retryButton")}</button>
            `;break;case"prompt":default:let f='<svg class="w-16 h-16 text-secondary opacity-50 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>',p=n("dictionarySubtitle"),h=`<div class="search-placeholder-notice">${n("dictionaryNotice")}</div>`;r=`
                ${f}
                <h3 class="text-xl font-semibold text-primary">${p}</h3>
                ${h}
            `;break}return r}function ne(e){let t=document.getElementById(e);if(!t)return;let n=(a,s={})=>{let i=u.appData.ui?.[u.currentLang]?.[a]||`[${a}]`;for(let[c,l]of Object.entries(s))i=i.replace(`{${c}}`,l);return i},r=n("errorContentNotAvailableTitle"),o=n("errorContentNotAvailableBody",{tabName:e,levelName:u.currentLevel.toUpperCase()});t.innerHTML=`
        <div class="p-6 text-center text-secondary content-anim-fade-in">
            <h3 class="font-semibold text-lg text-primary mb-2">${r}</h3>
            <p>${o}</p>
        </div>
    `}function et(e,t,n,r,o){let s=document.getElementById("accordion-template").content.cloneNode(!0),i=s.querySelector(".search-wrapper"),c=s.querySelector(".accordion-button"),l=s.querySelector(".accordion-title"),f=s.querySelector(".accordion-content"),p=u.openAccordions.get(o);return p&&p.has(r)&&c.classList.add("open"),i.dataset.search=n,c.dataset.sectionTitleKey=r,c.dataset.action="toggle-accordion",l.textContent=e,f.appendChild(t),s}function No(e,t){let n=document.createDocumentFragment();return t.forEach(r=>{let o=document.createElement("div");o.className="cheatsheet-card";let a=Object.keys(e).map(f=>I(r,f));o.dataset.searchItem=j(a);let s=document.createElement("div");s.className="cheatsheet-main";let i=document.createElement("h4");i.className="cheatsheet-particles",i.textContent=I(r,Object.keys(e)[0]);let c=document.createElement("p");c.className="cheatsheet-usage",c.textContent=I(r,Object.keys(e)[1]),s.appendChild(i),s.appendChild(c);let l=document.createElement("div");l.className="cheatsheet-example",l.innerHTML=I(r,Object.keys(e)[2]).replace(/\n/g,"<br>"),o.appendChild(s),o.appendChild(l),n.appendChild(o)}),n}function jo(e,t){let n=document.createElement("div");n.className="space-y-6";let r=Object.keys(t);return e.forEach(o=>{let a=document.createElement("div"),s=document.createElement("h4");s.className="font-semibold text-md mb-3 text-primary",s.textContent=I(o,"title"),a.appendChild(s);let i=document.createElement("div");i.className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",o.data.forEach(c=>{let l=document.createElement("div");l.className="cell-bg rounded-lg p-3 flex flex-col justify-center text-center h-24";let f="",p="";c.reading?(f=c.reading,p=I(c,"meaning")):(f=I(c,r[0]),p=I(c,r[1]));let h=j([f,p]);l.dataset.searchItem=h,l.innerHTML=`
                <div class="font-bold text-primary text-base sm:text-lg noto-sans">${f}</div>
                <div class="text-secondary text-xs sm:text-sm leading-relaxed mt-1" style="color: var(--accent-yellow)">${p}</div>
            `,i.appendChild(l)}),a.appendChild(i),n.appendChild(a)}),n}var an=(e,t,n)=>{let o=document.getElementById("card-template").content.cloneNode(!0),a=o.querySelector(".relative"),s=o.querySelector(".learn-toggle"),i=o.querySelector(".card-face-front"),c=o.querySelector(".card-face-back"),l=o.querySelector(".card");if(l&&(l.dataset.action="flip-card"),t==="kanji"){let E=document.createElement("div");E.className="details-toggle",E.dataset.action="show-kanji-details",E.dataset.id=e.id,E.innerHTML='<svg class="h-4 w-4 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" fill="currentColor"><path d="M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"/></svg>',a.prepend(E)}let f=u.progress[t]?.includes(e.id),p=I(e,"meaning"),h=t==="kanji"?`<p class="text-4xl sm:text-6xl font-bold noto-sans">${e.kanji}</p>`:`<div class="text-center p-2"><p class="text-xl sm:text-2xl font-semibold noto-sans">${e.word}</p></div>`,m="";t==="kanji"?(m=`<div class="w-full text-center"><p class="font-bold text-xl mb-2">${p}</p><div class="text-sm opacity-80"><p>On: ${e.onyomi}</p><p>Kun: ${e.kunyomi||"\u2013"}</p></div></div>`,c.style.justifyContent="center"):(m=`<p class="text-lg sm:text-xl font-bold">${e.reading}</p><p class="text-sm">${p}</p>`,c.style.justifyContent="space-around");let v=j([e.kanji,e.word,e.onyomi,e.kunyomi,e.reading,e.meaning?.en,e.meaning?.vi]);return a.dataset.searchItem=v,a.dataset.itemId=e.id,s.classList.toggle("learned",f),s.dataset.category=t,s.dataset.id=e.id,i.innerHTML=h,c.innerHTML=m,c.style.background=n,o};function Oo(e,t,n,r,o,a){if(!t||t.length===0)return document.createDocumentFragment();let s=document.createElement("div");s.className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4";let i=50,c=t.slice(0,i),l=document.createDocumentFragment();if(c.forEach(h=>{l.appendChild(an(h,n,r))}),s.appendChild(l),t.length>i){let h=document.createElement("div");h.className="sentinel",s.appendChild(h);let m=E=>an(E,n,r);W.set(a,{allItems:t,createFn:m,batchSize:i,currentIndex:i}),new IntersectionObserver(Mo,{rootMargin:"200px"}).observe(h)}let f=document.createElement("div");f.className="p-4 sm:p-5 sm:pt-0",f.appendChild(s);let p=j([e,...t.flatMap(h=>[h.kanji,h.word,h.meaning?.en,h.meaning?.vi])]);return et(e,f,p,o,a)}var sn=(e,t,n)=>{let r=document.createDocumentFragment();return e&&Object.entries(e).forEach(([o,a])=>{if(!a.items)return;let s=a.items,i=I(a),c=j([i,...s.flatMap(p=>p.isPlaceholder?[]:[p.kana,p.romaji])]),l=`<div class="kana-grid">${s.map(p=>{if(p.isPlaceholder)return"<div></div>";let m=p.kana&&p.kana.length>1?"kana-font-digraph":"kana-font";return`<div class="flex flex-col items-center justify-center p-2 rounded-xl h-20 sm:h-24 text-center cell-bg" data-search-item="${j([p.kana,p.romaji])}"><p class="noto-sans ${m}" style="color:${n};">${p.kana}</p><p class="text-xs sm:text-sm text-secondary">${p.romaji}</p></div>`}).join("")}</div>`,f=`<div class="search-wrapper glass-effect rounded-2xl p-4 sm:p-5 mb-6" data-search="${c}"><h3 class="text-lg sm:text-lg font-bold mb-4 flex items-center gap-2 text-primary" data-section-title-key="${o}"><span class="text-2xl">${t}</span> ${i}</h3>${l}</div>`;r.appendChild(document.createRange().createContextualFragment(f))}),r};function $o(e,t,n,r,o,a){let i=document.getElementById("progress-item-template").content.cloneNode(!0),c=i.querySelector(".progress-item-wrapper"),l=i.querySelector(".progress-fill"),f=i.querySelector(".progress-percentage"),p=i.querySelector(".progress-title"),h=i.querySelector(".progress-stats"),m=r>0?n/r*100:0,E=2*Math.PI*22,g=E-m/100*E,b=t.match(/\s(.*?)$/),x=b?t.replace(b[0],""):t,A=b?b[1]:"";return c.dataset.tabName=e,c.dataset.sectionKey=a,c.dataset.action="jump-to-section",l.style.strokeDasharray=E,l.style.strokeDashoffset=g,l.style.stroke=`url(#${o}-gradient)`,f.textContent=`${Math.round(m)}%`,p.textContent=`${x} ${A}`,h.textContent=`${n} / ${r}`,i}function Q(){let e=[d.progressOverview,d.progressTab];if(!u.appData.ui||!e.every(o=>o))return;let t='<svg width="0" height="0"><defs><linearGradient id="purple-gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#A78BFA" /><stop offset="100%" stop-color="#8B5CF6" /></linearGradient><linearGradient id="green-gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#4ADE80" /><stop offset="100%" stop-color="#22C55E" /></linearGradient></defs></svg>',n={kanji:"purple",vocab:"green"},r=document.createDocumentFragment();for(let[o,a]of Object.entries(n))if(u.appData[o])for(let s in u.appData[o]){let i=u.appData[o][s];if(!i.items||i.items.length===0)continue;let c=i.items.length,l=u.progress[o]?.filter(h=>i.items.some(m=>m.id===h)).length||0,f=I(i),p=$o(o,f,l,c,a,s);r.appendChild(p)}e.forEach(o=>{if(!o)return;o.innerHTML="";let a=document.createElement("div");if(a.className="space-y-4",a.id=`progress-wrapper-${o.id}`,a.appendChild(r.cloneNode(!0)),o.id==="progress-overview"){let s=document.createElement("h2");s.className="text-xl font-bold mb-5",s.dataset.langKey="progressOverview",s.textContent=u.appData.ui[u.currentLang]?.progressOverview||"Progress Overview",o.innerHTML=t,o.appendChild(s),o.appendChild(a)}else o.innerHTML=t,o.appendChild(a)})}function un(e){let t=e.querySelector("button.active"),n=e.querySelector(".lang-switch-pill");if(!t||!n)return;let r=t.offsetWidth,o=t.offsetLeft;requestAnimationFrame(()=>{n.style.width=`${r}px`,n.style.transform=`translateX(${o}px)`})}function xa(){let e=document.documentElement.classList.contains("dark-mode");document.querySelectorAll(".theme-switch input").forEach(t=>t.checked=e)}function tt(e){let t=d.pinToggle;if(!t)return;let n='<svg height="24" width="24" viewBox="0 0 519.657 1024"><path d="M196.032 704l64 320 64-320c-20.125 2-41.344 3.188-62.281 3.188C239.22 707.188 217.47 706.312 196.032 704zM450.032 404.688c-16.188-15.625-40.312-44.375-62-84.688v-64c7.562-12.406 12.25-39.438 23.375-51.969 15.25-13.375 24-28.594 24-44.875 0-53.094-61.062-95.156-175.375-95.156-114.25 0-182.469 42.062-182.469 95.094 0 16 8.469 31.062 23.375 44.312 13.438 14.844 22.719 38 31.094 52.594v64c-32.375 62.656-82 96.188-82 96.188h0.656C18.749 437.876 0 464.126 0 492.344 0.063 566.625 101.063 640.062 260.032 640c159 0.062 259.625-73.375 259.625-147.656C519.657 458.875 493.407 428.219 450.032 404.688z"/></svg>';t.innerHTML=n;let r=t.querySelector("svg"),o=e&&e===u.pinnedTab;t.classList.toggle("pinned",o),r.style.fill=o?"var(--pin-color)":"var(--pin-unpinned)",r.style.width="1.25em",r.style.height="1.25em"}function nt(){document.querySelectorAll(".sidebar-pin-btn").forEach(e=>{let t=e.dataset.tabName,n=e.closest(".nav-item-wrapper"),r=t===u.pinnedTab;n&&n.classList.toggle("is-pinned",r),e.classList.toggle("is-pinned",r),e.querySelector("svg")||(e.innerHTML='<svg viewBox="0 0 519.657 1024"><path d="M196.032 704l64 320 64-320c-20.125 2-41.344 3.188-62.281 3.188C239.22 707.188 217.47 706.312 196.032 704zM450.032 404.688c-16.188-15.625-40.312-44.375-62-84.688v-64c7.562-12.406 12.25-39.438 23.375-51.969 15.25-13.375 24-28.594 24-44.875 0-53.094-61.062-95.156-175.375-95.156-114.25 0-182.469 42.062-182.469 95.094 0 16 8.469 31.062 23.375 44.312 13.438 14.844 22.719 38 31.094 52.594v64c-32.375 62.656-82 96.188-82 96.188h0.656C18.749 437.876 0 464.126 0 492.344 0.063 566.625 101.063 640.062 260.032 640c159 0.062 259.625-73.375 259.625-147.656C519.657 458.875 493.407 428.219 450.032 404.688z"/></svg>');let o=e.querySelector("svg");o.style.fill=r?"var(--pin-pinned-bg)":"var(--text-secondary)"})}function re(){d.sidebar?.classList.remove("open"),d.overlay?.classList.remove("active"),document.body.classList.remove("sidebar-open")}async function cn(e,t,n,r){let o=document.getElementById(e);if(!o)return;if(o.innerHTML="",!t){ne(e);return}let a=document.createElement("div");if(a.className="space-y-4",o.appendChild(a),W.has(e)){let s=W.get(e).observer;s&&s.disconnect(),W.delete(e)}for(let s in t){let i=t[s];if(!i.items)continue;let c=I(i),l=Oo(c,i.items,n,r,s,e);a.appendChild(l)}q(n)}function we(e){if(!u.appData.kanji)return null;for(let t in u.appData.kanji){let n=u.appData.kanji[t].items.find(r=>r.kanji===e);if(n)return n}return null}function Z(e,t={},n=!1){if(!d.externalSearchTab)return;let{results:r,query:o}=t,a=(l,f)=>u.appData.ui?.[u.currentLang]?.[l]||f,s=d.externalSearchTab.querySelector(":scope > .flex.justify-center.items-center");s&&s.remove();let i=d.externalSearchTab.querySelector(".results-container");i||(i=document.createElement("div"),i.className="results-container",d.externalSearchTab.appendChild(i));let c=d.externalSearchTab.querySelector(".placeholder-container");if(c||(c=document.createElement("div"),c.className="placeholder-container search-placeholder-wrapper",c.innerHTML='<div class="search-placeholder-box"></div>',d.externalSearchTab.appendChild(c)),e==="results"&&(d.externalSearchTab.innerHTML="",d.externalSearchTab.appendChild(i),d.externalSearchTab.appendChild(c)),e==="results"){c.style.display="none",i.style.display="block",i.innerHTML="";let l=document.createDocumentFragment(),f=r?.words?.length>0,p=r?.kanji?.length>0;if(f){let m=document.createElement("div");m.className="search-wrapper glass-effect rounded-2xl p-4 sm:p-5 mb-6";let v=document.createElement("h3");v.className="text-lg sm:text-lg font-bold mb-4 text-primary",v.textContent=a("vocabResults","Vocabulary Results"),m.appendChild(v);let E=document.createElement("div");E.className="dict-grid",r.words.forEach(g=>{if(!g?.reading||!g?.senses)return;let b=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/;if(u.currentLang==="vi"&&!b.test(g.reading.kanji))g.senses.forEach(A=>{let S=A.glosses?.[0]||"";if(!S)return;let F=document.createElement("div");F.className="dict-card";let K=A.reading||"",T=S.split("").map(L=>/[\u4e00-\u9faf]/.test(L)&&we(L)?`<span class="hover:text-accent-teal cursor-pointer transition-colors" data-action="show-kanji-details" data-id="${we(L).id}">${L}</span>`:`<span>${L}</span>`).join("");F.innerHTML=`<div class="dict-vocab-header"><h4 class="dict-vocab-term">${T}</h4>${K?`<span class="dict-vocab-reading">(${K})</span>`:""}</div><div class="dict-vocab-definitions"><p>${g.reading.kanji}</p></div>`,E.appendChild(F)});else{let A=document.createElement("div");A.className="dict-card";let S=g.reading.kanji||g.reading.kana||"",F=g.reading.kana&&g.reading.kana!==S?`(${g.reading.kana})`:"";if(!S)return;let T=`<div class="dict-vocab-header"><h4 class="dict-vocab-term">${S.split("").map(C=>/[\u4e00-\u9faf]/.test(C)&&we(C)?`<span class="hover:text-accent-teal cursor-pointer transition-colors" data-action="show-kanji-details" data-id="${we(C).id}">${C}</span>`:`<span>${C}</span>`).join("")}</h4><span class="dict-vocab-reading">${F}</span></div>`,L=(g.senses??[]).map(C=>{let ie=C.glosses?.join("; ")??"",J=[...new Set((C.pos??[]).map(ce=>typeof ce=="object"?Object.keys(ce)[0]:ce))],P=J.length>0?`<span class="dict-vocab-pos">[${J.join(", ")}]</span>`:"";return`<p>${ie} ${P}</p>`}).join("");A.innerHTML=`${T}<div class="dict-vocab-definitions">${L}</div>`,E.appendChild(A)}}),m.appendChild(E),l.appendChild(m)}if(p){let m=document.createElement("div");m.className="search-wrapper glass-effect rounded-2xl p-4 sm:p-5 mb-6";let v=document.createElement("h3");v.className="text-lg sm:text-lg font-bold mb-4 text-primary",v.textContent=a("kanjiResults","Kanji Results"),m.appendChild(v);let E=document.createElement("div");E.className="dict-grid",r.kanji.forEach(g=>{if(!g?.literal)return;let b=document.createElement("div");b.className="dict-card";let x=g.onyomi?.join(", ")||"\u2013",A=g.kunyomi?.join(", ")||"\u2013",S=g.meanings?.join("; ")||a("noDefinition","No definition found.");b.innerHTML=`<div class="dict-kanji-header"><h4 class="dict-kanji-char">${g.literal}</h4><div class="dict-kanji-readings"><p><span class="reading-label">${a("onyomi","On'yomi:")}</span> ${x}</p><p><span class="reading-label">${a("kunyomi","Kun'yomi:")}</span> ${A}</p></div></div><div class="dict-kanji-meanings">${S}</div>`,E.appendChild(b)}),m.appendChild(E),l.appendChild(m)}let h=document.createElement("div");n||(h.className="anim-fade-in"),h.appendChild(l),i.appendChild(h)}else{i.style.display="none",c.style.display="flex";let l=c.querySelector(".search-placeholder-box");l&&(l.innerHTML="",l.innerHTML=Bo(e,o),n||(l.classList.remove("anim-fade-in"),l.offsetWidth,l.classList.add("anim-fade-in")))}}function ln(e){if(!e)return{};let t=JSON.parse(JSON.stringify(e)),n={gojuon:["a","i","u","e","o","ka","ki","ku","ke","ko","sa","shi","su","se","so","ta","chi","tsu","te","to","na","ni","nu","ne","no","ha","hi","fu","he","ho","ma","mi","mu","me","mo","ya",null,"yu",null,"yo","ra","ri","ru","re","ro","wa",null,null,null,"wo","n",null,null,null,null],dakuten:["ga","gi","gu","ge","go","za","ji","zu","ze","zo","da","di","dzu","de","do","ba","bi","bu","be","bo"],handakuten:["pa","pi","pu","pe","po"],youon:["kya","kyu","kyo","sha","shu","sho","cha","chu","cho","nya","nyu","nyo","hya","hyu","hyo","mya","myu","myo","rya","ryu","ryo","gya","gyu","gyo","ja","ju","jo","bya","byu","byo","pya","pyu","pyo"]};for(let r in t){let o=t[r];if(!o?.items?.length)continue;let a=o.items,s=new Set(a.map(l=>l.romaji)),i=l=>a.find(f=>f.romaji===l)||{isPlaceholder:!0},c=null;s.has("kya")||s.has("gya")?c=n.youon:s.has("ga")||s.has("za")?c=n.dakuten:s.has("pa")?c=n.handakuten:s.has("a")&&(c=n.gojuon),c&&(o.items=c.map(l=>l?i(l):{isPlaceholder:!0}))}return t}async function dn(e){let n=await(await w).get("levels",e),r=n?Object.keys(n):["kanji","vocab","grammar","keyPoints","hiragana","katakana"];document.querySelectorAll(".nav-item-wrapper").forEach(i=>{let c=i.querySelector("[data-tab-name]")?.dataset.tabName;c&&!["progress","external-search"].includes(c)&&(i.style.display=r.includes(c)?"":"none")});let o=["n5","n4"].includes(e),a=document.querySelector('[data-tab-name="hiragana"]')?.parentElement,s=document.querySelector('[data-tab-name="katakana"]')?.parentElement;a&&(a.style.display=o?"":"none"),s&&(s.style.display=o?"":"none")}async function fn(e=null){let t=async(o,a)=>{try{u.appData[a]?await o():await(await w).get("levels",u.currentLevel)&&ne(a)}catch(s){console.error("Render error in tab",a,":",s),ne(a)}},n=e?[e]:Object.keys(u.appData).filter(o=>!["ui","progress","external-search"].includes(o)),r={hiragana:()=>t(()=>{d.hiraganaTab&&u.appData.hiragana&&(d.hiraganaTab.innerHTML="",d.hiraganaTab.appendChild(sn(ln(u.appData.hiragana),"\u{1F338}","var(--accent-pink)")),q("hiragana"))},"hiragana"),katakana:()=>t(()=>{d.katakanaTab&&u.appData.katakana&&(d.katakanaTab.innerHTML="",d.katakanaTab.appendChild(sn(ln(u.appData.katakana),"\u{1F916}","var(--accent-blue)")),q("katakana"))},"katakana"),keyPoints:()=>t(()=>{if(!d.keyPointsTab||!u.appData.keyPoints)return;d.keyPointsTab.innerHTML="";let o=document.createDocumentFragment();for(let s in u.appData.keyPoints){let i=u.appData.keyPoints[s],c=I(i),l;if(i.type==="table"?l=No(i.headers,i.content):i.type==="table-grid"&&(l=jo(i.content,i.headers)),l){let f=document.createElement("div");f.className="p-4 sm:p-5 sm:pt-0",f.appendChild(l);let p=j([c,JSON.stringify(i.content)]);o.appendChild(et(c,f,p,s,"keyPoints"))}}let a=document.createElement("div");a.className="space-y-4",a.appendChild(o),d.keyPointsTab.appendChild(a),q("keyPoints")},"keyPoints"),grammar:()=>t(()=>{if(!d.grammarTab||!u.appData.grammar)return;d.grammarTab.innerHTML="";let o=document.createDocumentFragment();for(let s in u.appData.grammar){let i=u.appData.grammar[s],c=I(i),l=document.createElement("div");l.className="grammar-grid",i.items.forEach(h=>{let m=h[u.currentLang]||h.en,v=j([m.title,m.content]),E=/(<br>)?<b>(Example|Ví dụ).*?<\/b>/i,g=m.content.match(E),b=m.content,x="";g?.index&&(b=m.content.substring(0,g.index),x=m.content.substring(g.index).replace(/^<br>/,""));let A=document.createElement("div");A.className="grammar-card cell-bg rounded-lg",A.dataset.searchItem=v,A.innerHTML=`<h4 class="font-semibold text-primary noto-sans">${m.title}</h4><div class="grammar-description mt-2 text-secondary leading-relaxed text-sm">${b}</div>${x?`<div class="grammar-example mt-3 text-sm">${x}</div>`:""}`,l.appendChild(A)});let f=document.createElement("div");f.className="p-4 sm:p-5 sm:pt-0",f.appendChild(l);let p=j([c,...i.items.flatMap(h=>[h.en?.title,h.en?.content,h.vi?.title,h.vi?.content])]);o.appendChild(et(c,f,p,s,"grammar"))}let a=document.createElement("div");a.className="space-y-4",a.appendChild(o),d.grammarTab.appendChild(a),q("grammar")},"grammar"),kanji:()=>t(()=>cn("kanji",u.appData.kanji,"kanji","linear-gradient(135deg, var(--accent-purple), #A78BFA)"),"kanji"),vocab:()=>t(()=>cn("vocab",u.appData.vocab,"vocab","linear-gradient(135deg, var(--accent-green), #4ADE80)"),"vocab")};for(let o of n)r[o]&&await r[o]()}function pn(e=[],t=[]){let n=document.getElementById("level-switcher-sidebar");if(!n)return;u.allAvailableLevels=Array.from(new Set([...e,...t]));let r=document.createDocumentFragment();u.allAvailableLevels.forEach(o=>{let a=o===k.defaultLevel,i=t.includes(o)&&!a?`<button class="delete-level-btn" data-action="delete-level" data-level-name="${o}" title="Delete level ${o.toUpperCase()}"><svg class="w-4 h-4 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>`:"",c=document.createElement("div");c.className="level-switch-item-wrapper",c.innerHTML=`<button data-action="set-level" data-level-name="${o}" class="level-switch-button">${o.toUpperCase()}</button>${i}`,r.appendChild(c)}),n.innerHTML="",n.appendChild(r)}function Ca(){let e=document.querySelector("#level-switcher-sidebar .level-switch-button.active");e&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100)}function rt(e){let t=(s,i="")=>u.appData.ui?.[u.currentLang]?.[s]||i,n=e==="external-search",r=e==="progress",o=n?t("dictionaryPrompt","Search for words..."):t("searchPlaceholder","Search anything..."),a=n?t("dictionaryPrompt","Search for words..."):t("searchTabPlaceholder","Search in this tab...");d.searchInput&&(d.searchInput.placeholder=r?"Search not available in Progress tab":o,d.searchInput.disabled=r),d.mobileSearchInput&&(d.mobileSearchInput.placeholder=a)}function hn({title:e,message:t,buttons:n,onOpen:r,onClose:o}){return new Promise(a=>{if(!d.customDialogContainer)return;let i=document.getElementById("custom-dialog-template").content.cloneNode(!0),c=d.customDialogContainer.querySelector(".modal-content-container");if(!c)return;c.innerHTML="",c.appendChild(i);let l=c.querySelector("#custom-dialog-title"),f=c.querySelector("#custom-dialog-message"),p=c.querySelector("#custom-dialog-actions"),h=c.querySelector("#custom-dialog-close-btn");l.textContent=e,f.textContent=t,p.innerHTML="";let m,v=g=>()=>{m(),_o(),a(g==="confirm"?"confirm":"cancel"),o&&o(g)};n.forEach(g=>{let b=document.createElement("button");b.textContent=g.text,b.className=`modal-button ${g.className||"modal-button-secondary"}`,b.dataset.actionType=g.action,b.addEventListener("click",v(g.action)),p.appendChild(b)}),h.addEventListener("click",v("cancel"));let E=g=>{(g.target===d.customDialogBackdrop||g.target===d.customDialogWrapper)&&v("cancel")()};d.customDialogBackdrop.addEventListener("click",E),d.customDialogWrapper.addEventListener("click",E),m=()=>{d.customDialogBackdrop.removeEventListener("click",E),d.customDialogWrapper.removeEventListener("click",E),h.removeEventListener("click",v("cancel")),n.forEach(g=>{let b=p.querySelector(`[data-action-type="${g.action}"]`);b&&b.removeEventListener("click",v(g.action))})},document.body.classList.add("body-no-scroll"),d.customDialogContainer.classList.remove("modal-hidden"),d.customDialogBackdrop.classList.add("active"),d.customDialogWrapper.classList.add("active"),r&&r()})}function oe(e,t){return hn({title:e,message:t,buttons:[{text:(r=>u.appData.ui?.[u.currentLang]?.[r]||`[${r}]`)("okButton","OK"),className:"modal-button-primary",action:"confirm"}]}).then(()=>{})}function mn(e,t){let n=r=>u.appData.ui?.[u.currentLang]?.[r]||`[${r}]`;return hn({title:e,message:t,buttons:[{text:n("cancelButton","Cancel"),className:"modal-button-secondary",action:"cancel"},{text:n("confirmButton","Confirm"),className:"modal-button-primary",action:"confirm"}]}).then(r=>r==="confirm")}function _o(){if(!d.customDialogContainer||d.customDialogContainer.classList.contains("modal-hidden"))return;let e=d.customDialogBackdrop,t=d.customDialogWrapper,n=d.customDialogContainer;document.body.classList.remove("body-no-scroll"),e&&e.classList.remove("active"),t&&t.classList.remove("active");let r=o=>{if(o.target!==t)return;n.classList.add("modal-hidden");let a=n.querySelector(".modal-content-container");a&&(a.innerHTML=""),t.removeEventListener("transitionend",r)};if(t&&getComputedStyle(t).transitionDuration!=="0s")t.addEventListener("transitionend",r,{once:!0});else{n.classList.add("modal-hidden");let o=n.querySelector(".modal-content-container");o&&(o.innerHTML="")}}var w=rn("HandbookDB",3,{upgrade(e,t){t<1&&(e.createObjectStore("levels"),e.createObjectStore("progress"),e.createObjectStore("settings")),t<2&&e.createObjectStore("dictionary_cache"),t<3&&e.createObjectStore("notes")}});async function Da(){try{let e=await fetch(`./data/${k.defaultLevel}/ui.json`);if(!e.ok)throw new Error(`Failed to fetch UI data: ${e.status}`);u.appData.ui=await e.json()}catch(e){console.error("Fatal: Could not load the global ui.json file.",e),u.appData.ui={en:{error:"UI failed to load"}}}}async function Ia(){try{let e=await w,[t,n,r]=await Promise.all([e.get("settings","language"),e.get("settings","currentLevel"),e.get("settings","levelSettings")]);u.currentLang=t||"en",u.currentLevel=n||k.defaultLevel;let o=r?.[u.currentLevel];u.pinnedTab=o?.pinnedTab||null,u.openAccordions=new Map((o?.openAccordions||[]).map(([a,s])=>[a,new Set(s)])),u.progress=await e.get("progress",u.currentLevel)||{kanji:[],vocab:[]}}catch(e){console.error("Error loading state from IndexedDB:",e),u.currentLang="en",u.currentLevel=k.defaultLevel,u.progress={kanji:[],vocab:[]},u.openAccordions=new Map}}async function gn(){try{await(await w).put("progress",u.progress,u.currentLevel),Q()}catch(e){console.error("Error saving progress to IndexedDB:",e)}}async function ae(e,t){try{await(await w).put("settings",t,e)}catch(n){console.error(`Error saving setting '${e}' to IndexedDB:`,n)}}async function yn(){try{let e=await w,t=await e.get("settings","levelSettings")||{};t[u.currentLevel]||(t[u.currentLevel]={});let n=Array.from(u.openAccordions.entries()).map(([r,o])=>[r,Array.from(o)]);t[u.currentLevel].openAccordions=n,await e.put("settings",t,"levelSettings")}catch(e){console.error("Error saving accordion state:",e)}}async function ot(e,t){if(!u.appData[t])try{let n=await fetch(`${k.dataPath}/${e}/${t}.json`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let r=await n.json();u.appData[t]=r}catch(n){throw console.error(`Error loading data for tab ${t}:`,n),n}}async function vn(e){let n=await(await w).get("levels",e),r=u.appData.ui;u.appData={ui:r},n&&Object.assign(u.appData,n)}async function Ma(e,t,n){try{let r=await w,o=`${e}-${t}`,a={content:n,lastModified:new Date().toISOString()};await r.put("notes",a,o)}catch(r){console.error(`Error saving note for ${e}-${t}:`,r)}}async function Ba(e,t){try{let n=await w,r=`${e}-${t}`;return await n.get("notes",r)||null}catch(n){return console.error(`Error loading note for ${e}-${t}:`,n),null}}async function En(e){try{let n=(await w).transaction("notes","readwrite"),o=(await n.store.getAllKeys()).filter(a=>a.startsWith(`${e}-`));await Promise.all(o.map(a=>n.store.delete(a))),await n.done}catch(t){console.error(`Error deleting notes for level ${e}:`,t)}}var Ro=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/,Po="https://jdict-backend-dev.up.railway.app/api/v1/search",Fo="https://jotoba.de/api/search/words",Ko=1e4,Ho=24*60*60*1e3,bn=1e3,An=2,Uo=1e3,at=0,xe=0;function qo(e){return new Promise((t,n)=>setTimeout(()=>n(new Error("Request timeout")),e))}function Wo(e){let t=Uo*Math.pow(2,e);return new Promise(n=>setTimeout(n,t))}function Jo(e){return["Request timeout","Rate limit exceeded","Server error","Failed to fetch","NetworkError"].some(n=>e.message.includes(n))}async function it(e,t={},n,r=An){let o=Date.now();if(o-at<bn&&await new Promise(a=>setTimeout(a,bn-(o-at))),at=Date.now(),n.aborted)throw new DOMException("Request was aborted","AbortError");try{let a=await Promise.race([fetch(e,{...t,signal:n}),qo(Ko)]);if(!a.ok)throw a.status===429?new Error("Rate limit exceeded"):a.status>=500?new Error(`Server error: ${a.status}`):new Error(`HTTP error: ${a.status}`);return a}catch(a){if(a.name==="AbortError")throw a;if(r>0&&Jo(a))return console.warn(`Request failed, retrying... (${r} attempts left):`,a.message),await Wo(An-r),it(e,t,n,r-1);throw a}}function zo(e){if(!e||typeof e!="string")return[];try{let t=/「(.*?)」/;return e.split(";").map(n=>n.trim()).filter(Boolean).map(n=>{let r=n.match(t);if(r){let o=r[1];return{kanji:n.replace(t,"").trim()||o,kana:o}}return{kanji:n,kana:n}})}catch(t){return console.warn("Error parsing suggest_mean:",t),[]}}function Vo(e,t){if(!e?.list?.length)return null;try{return{words:t?e.list.map(r=>{let o=(r.suggest_mean||"").split(";").map(i=>i.trim()).filter(Boolean),a=(r.word||"").match(/「(.*?)」/);return{reading:{kanji:(r.word||"").replace(/「(.*?)」/,"").trim()||(a?a[1]:""),kana:a?a[1]:""},senses:[{glosses:o}]}}):e.list.map(r=>({reading:{kanji:r.word||"",kana:""},senses:zo(r.suggest_mean).map(o=>({glosses:[o.kanji],reading:o.kana}))})),kanji:[]}}catch(n){return console.warn("Error transforming JDict data:",n),null}}async function Go(e,t,n){let r=new URL(Po);r.search=new URLSearchParams({keyword:e.trim(),keyword_position:"start",page:1,type:"word"}).toString();let a=await(await it(r,{},n)).json();return Vo(a,t)}async function Yo(e,t,n){let o=await(await it(Fo,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:e.trim(),language:t?"Japanese":"English",no_english:!1})},n)).json();if(!o||!o.words?.length&&!o.kanji?.length)throw new Error("No results found");return{words:o.words||[],kanji:o.kanji||[]}}async function Qo(e,t){try{let n=await e.get("dictionary_cache",t);if(n?.timestamp&&Date.now()-n.timestamp<Ho)return n;n&&await e.delete("dictionary_cache",t)}catch(n){console.warn("Cache retrieval failed:",n)}return null}async function Zo(e,t,n){try{await e.put("dictionary_cache",{data:n,lang:u.currentLang,timestamp:Date.now()},t)}catch(r){console.warn("Cache storage failed:",r)}}function st(e,t){return u.appData?.ui?.[u.currentLang]?.[e]||t}function Xo(e,t){let n,r={timeout:"searchTimeout","Rate limit":"searchRateLimitError","Server error":"searchServerError",Network:"searchNetworkError","No results":"noResults"},o=Object.keys(r).find(l=>e.message.includes(l))||"default";if(o==="noResults"){Z("no-results",{query:t});return}n=st(r[o],"Could not fetch results. Please try again.");let s=`
        <div class="search-placeholder-box text-center content-anim-fade-in">
            <svg class="w-16 h-16 text-red-400 opacity-80 mb-4 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
            <h3 class="text-xl font-semibold text-primary">${st("searchErrorTitle","Search Error")}</h3>
            <p class="text-secondary text-base mt-1 max-w-md mx-auto">${n}</p>
            <button class="mt-4 px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark transition-colors" onclick="window.handleExternalSearch('${t.replace(/'/g,"\\'")}', true)">
                ${st("retryButton","Retry")}
            </button>
        </div>`,i=d.externalSearchTab.querySelector(".placeholder-container"),c=d.externalSearchTab.querySelector(".results-container");c&&(c.style.display="none"),i&&(i.style.display="flex",i.innerHTML=s)}async function ea(e,t,n){if(u.currentLang==="vi")try{let r=await Go(e,t,n);if(r)return r;console.log("JDict failed or returned no results, falling back to Jotoba.")}catch(r){if(r.name==="AbortError")throw r;console.warn("JDict search failed, falling back to Jotoba:",r.message)}return await Yo(e,t,n)}async function ct(e,t=!1,n=!1){let r=++xe,o=new AbortController;window.activeSearchController&&window.activeSearchController.abort(),window.activeSearchController=o;let{signal:a}=o,s=e.trim();if(s.length===0){Z("prompt",{},n);return}let i=await w;if(!t){let c=await Qo(i,s);if(c&&c.lang===u.currentLang){r===xe&&Z("results",{results:c.data,query:s},n);return}}n||Z("searching",{query:s},!1);try{let c=Ro.test(s),l=await ea(s,c,a);r===xe&&(await Zo(i,s,l),Z("results",{results:l,query:s},n))}catch(c){c.name!=="AbortError"&&r===xe&&(console.error("External Search Error:",c),Xo(c,s))}finally{window.activeSearchController===o&&(window.activeSearchController=null)}}window.handleExternalSearch=ct;var Pa=he(ct,300),lt=ct;function N(e,t={}){let n=u.appData.ui?.[u.currentLang]?.[e]||u.appData.ui?.en?.[e]||`[${e}]`;for(let[r,o]of Object.entries(t))n=n.replace(`{${r}}`,o);return n}function se(){return window.innerWidth<=768?d.mobileSearchInput:d.searchInput}function ut(e){if(!e||!e.startsWith("n"))return!1;let t=parseInt(e.substring(1),10);return!isNaN(t)&&t<=3}function ta(e,t){if(!t)return;let n=new RegExp(`(${t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")})`,"gi"),r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),o=[],a;for(;a=r.nextNode();)n.test(a.nodeValue)&&o.push(a);o.forEach(s=>{let i=document.createDocumentFragment();s.nodeValue.split(n).forEach(c=>{if(c.toLowerCase()===t.toLowerCase()){let l=document.createElement("mark");l.className="search-highlight",l.textContent=c,i.appendChild(l)}else i.appendChild(document.createTextNode(c))}),s.parentNode?.replaceChild(i,s)})}function Ya(e,t,n){u.progress[e]||(u.progress[e]=[]);let r=u.progress[e],o=r.indexOf(t);o>-1?(r.splice(o,1),n.classList.remove("learned")):(r.push(t),n.classList.add("learned")),gn()}function Qa(e){let t=u.activeTab,n=e.dataset.sectionTitleKey;if(!t||!n)return;let r=e.classList.toggle("open");u.openAccordions.has(t)||u.openAccordions.set(t,new Set);let o=u.openAccordions.get(t);r?o.add(n):o.delete(n),yn()}function q(e){if(u.fuseInstances[e]||!u.appData[e])return;let t=document.getElementById(e);if(!t)return;let r=Array.from(t.querySelectorAll("[data-search-item]")).map(o=>({id:o.dataset.itemId||o.closest("[data-item-id]")?.dataset.itemId||o.textContent.trim(),element:o,searchData:o.dataset.searchItem}));r.length>0&&(u.fuseInstances[e]=new R(r,{keys:["searchData"],includeScore:!0,threshold:.3,ignoreLocation:!0,useExtendedSearch:!0}))}var wn=he(()=>{let e=se().value.trim().toLowerCase(),t=document.querySelector(".tab-content.active");if(!t)return;let n=t.id;if(n==="external-search"){lt(e);return}let r=t.querySelectorAll(".search-wrapper"),o=t.querySelectorAll("[data-search-item]");if(o.forEach(l=>{l.classList.remove("search-hidden");let f=l.dataset.originalHtml;f&&(l.innerHTML=f,l.removeAttribute("data-original-html"))}),r.forEach(l=>{l.style.display="";let f=l.querySelector(".accordion-button"),p=u.openAccordions.get(n),h=f?.dataset.sectionTitleKey;f&&h&&f.classList.toggle("open",p?.has(h))}),!e)return;let a=u.fuseInstances[n];if(!a)return;let s=a.search(e),i=new Set(s.map(l=>l.item.element)),c=new Set;o.forEach(l=>{if(!i.has(l))l.classList.add("search-hidden");else{l.dataset.originalHtml||(l.dataset.originalHtml=l.innerHTML),ta(l,e);let f=l.closest(".search-wrapper");f&&c.add(f)}}),r.forEach(l=>{if(!c.has(l))l.style.display="none";else{let f=l.querySelector(".accordion-button");f&&!f.classList.contains("open")&&f.classList.add("open")}})},300);function na(e,t=!1){u.currentLang=e,ae("language",e),u.renderedTabs&&u.renderedTabs.clear();let n=u.appData.ui,r=a=>(n?.[e]?.[a]||n?.en?.[a]||`[${a}]`).replace("{level}",u.currentLevel.toUpperCase());document.querySelectorAll("[data-lang-key]").forEach(a=>{a.textContent=r(a.dataset.langKey)}),document.querySelectorAll("[data-lang-placeholder-key]").forEach(a=>{a.placeholder=r(a.dataset.langPlaceholderKey)}),document.querySelectorAll(".lang-switch button").forEach(a=>a.classList.toggle("active",a.dataset.lang===e)),document.querySelectorAll(".lang-switch").forEach(un);let o=document.querySelector(".nav-item.active");if(o&&d.mobileHeaderTitle){let a=o.querySelector("span"),s=a?.dataset.langKey;d.mobileHeaderTitle.textContent=s?r(s):a?.textContent||""}if(!t){let a=document.querySelector(".tab-content.active");a&&ft(a.id,null,!0,!0,!0),Q()}rt(u.activeTab)}function Za(){let e=document.documentElement.classList.toggle("dark-mode"),t=e?"dark":"light";ae("theme",t);try{localStorage.setItem("theme",t)}catch(n){console.warn("Could not save theme to localStorage.",n)}d.themeEmoji&&(d.themeEmoji.textContent=e?"\u{1F319}":"\u2600\uFE0F"),document.querySelectorAll(".theme-switch input").forEach(n=>{n.checked=e})}function ra(){if(!d.loadingOverlay)return;let e=d.loadingOverlay.cloneNode(!0);d.loadingOverlay.parentNode.replaceChild(e,d.loadingOverlay),d.loadingOverlay=e,d.loadingOverlay.innerHTML='<div class="loader"></div>',d.loadingOverlay.classList.remove("hidden"),requestAnimationFrame(()=>{d.loadingOverlay.style.opacity="1"})}function oa(){return new Promise(e=>{if(!d.loadingOverlay||d.loadingOverlay.style.opacity==="0"){e();return}let t=n=>{n.target===d.loadingOverlay&&(d.loadingOverlay.classList.add("hidden"),d.loadingOverlay.removeEventListener("transitionend",t),e())};d.loadingOverlay.addEventListener("transitionend",t),d.loadingOverlay.style.opacity="0",setTimeout(()=>{t({target:d.loadingOverlay})},500)})}async function aa(e){u.currentLevel=e,await ae("currentLevel",e);let t=[vn(e),w.then(i=>i.get("progress",u.currentLevel)),w.then(i=>i.get("settings","levelSettings"))],[n,r,o]=await Promise.all(t);if(u.progress=r||{kanji:[],vocab:[]},u.pinnedTab=o?.[u.currentLevel]?.pinnedTab||null,u.fuseInstances={},u.lastDictionaryQuery="",u.notes.data=new Map,u.notes.originalContent="",u.renderedTabs&&u.renderedTabs.clear(),!!!await(await w).get("levels",e)){let i=["kanji","vocab","grammar","keyPoints"];ut(e)||i.push("hiragana","katakana"),Promise.all(i.map(c=>ot(e,c).catch(l=>{console.warn(`Non-critical preload of tab '${c}' failed.`,l)}))).then(()=>console.log(`Pre-loading for level ${e} complete.`))}}async function sa(e,t){document.querySelectorAll(".tab-content").forEach(s=>{s.innerHTML=""}),Q(),na(u.currentLang,!0),document.querySelectorAll(".level-switch-button").forEach(s=>s.classList.toggle("active",s.dataset.levelName===e)),nt(),await dn(e);let n=!ut(e),o=window.innerWidth<=768?"external-search":n?"hiragana":"keyPoints",a=u.pinnedTab||o;ut(e)&&(a==="hiragana"||a==="katakana")&&(a="keyPoints",u.pinnedTab=null,await dt(null)),await ft(a,null,!1,t,!0)}async function ia(e,t=!1){if(u.isSwitchingLevel||e===u.currentLevel){e===u.currentLevel&&re();return}u.isSwitchingLevel=!0,u.loadingStatus="loading";let n=new Promise(r=>setTimeout(r,500));ra();try{await Promise.all([aa(e),n]),await sa(e,t),u.loadingStatus="idle"}catch(r){if(console.error(`Failed to load level ${e}:`,r),u.loadingStatus="error",d.loadingOverlay){let o=N("errorLoadLevelTitle"),a=N("errorLoadLevelBody");oe(o,`${r.message}

${a}`)}return}finally{u.isSwitchingLevel=!1,u.loadingStatus!=="error"&&await oa(),re()}}async function dt(e){try{let n=await(await w).get("settings","levelSettings")||{};n[u.currentLevel]={...n[u.currentLevel],pinnedTab:e||null},await ae("levelSettings",n),tt(e),nt()}catch(t){console.error("Error saving pinned tab setting:",t)}}function Xa(){let e=document.querySelector(".tab-content.active");if(!e)return;let t=e.id;u.pinnedTab===t&&(d.pinToggle.classList.add("unpinning"),d.pinToggle.addEventListener("animationend",()=>d.pinToggle.classList.remove("unpinning"),{once:!0})),u.pinnedTab=u.pinnedTab===t?null:t,dt(u.pinnedTab)}function es(e,t){e.stopPropagation(),u.pinnedTab=u.pinnedTab===t?null:t,dt(u.pinnedTab)}function ca(e){document.querySelectorAll(".nav-item").forEach(a=>a.classList.toggle("active",a.dataset.tabName===e));let t=document.querySelector(`.nav-item[data-tab-name="${e}"]`),n=window.innerWidth<=768;if(n&&(d.mobileSearchBar&&d.mobileSearchBar.classList.toggle("visible",e!=="progress"),t&&d.mobileHeaderTitle)){let a=t.querySelector("span"),s=a?.dataset.langKey;d.mobileHeaderTitle.textContent=s?N(s):a?.textContent||""}d.pinToggle&&(d.pinToggle.style.display=n?"block":"none",tt(e));let o=!["progress","external-search"].includes(e)?"flex":"none";d.desktopNotesBtn&&(d.desktopNotesBtn.style.display=o),d.mobileNotesBtn&&(d.mobileNotesBtn.style.display=o),rt(e)}async function ft(e,t,n=!1,r=!1,o=!1){let a=document.querySelector(".tab-content.active");if(a?.id===e&&!o){re();return}u.activeTab=e,ca(e),re(),a&&(u.tabScrollPositions.set(a.id,window.scrollY),a.classList.remove("active"));let s=document.getElementById(e);if(!s){console.error(`Tab container not found for tab: ${e}`);return}if(s.classList.add("active"),!r){let c=`?level=${u.currentLevel}&tab=${e}`;history.pushState({type:"tab",tabName:e,level:u.currentLevel},"",c)}a?.id==="external-search"&&(u.lastDictionaryQuery=se().value.trim());let i=!["external-search","progress"].includes(e);if(i)if(o||!u.renderedTabs.has(e)){let c=document.getElementById("content-loader-template");s.innerHTML=c?c.innerHTML:'<div class="loader"></div>';try{u.appData[e]||await ot(u.currentLevel,e),await fn(e),u.renderedTabs.set(e,s.innerHTML)}catch(l){console.error(`Error loading or rendering data for tab ${e}:`,l),ne(e),u.renderedTabs.delete(e)}}else s.innerHTML=u.renderedTabs.get(e),q(e);else e==="external-search"?(s.innerHTML="",se().value=u.lastDictionaryQuery,lt(u.lastDictionaryQuery,!1,!0)):e==="progress"&&Q();i&&se().value&&(se().value="",wn.cancel(),wn()),n||window.scrollTo({top:u.tabScrollPositions.get(e)||0,behavior:"instant"})}function ts(e,t){let r=document.querySelector(".tab-content.active")?.id===e,o=()=>{requestAnimationFrame(()=>{let a=document.querySelector(`[data-section-title-key="${t}"]`);if(!a)return;a.closest(".accordion-wrapper")&&a.tagName==="BUTTON"&&!a.classList.contains("open")&&a.click(),setTimeout(()=>{let c=a.getBoundingClientRect().top+window.scrollY,l=document.querySelector(".mobile-header.sticky"),f=l?.isConnected&&getComputedStyle(l).position==="sticky"?l.offsetHeight:0;window.scrollTo({top:c-f-20,behavior:"smooth"});let p=a.closest(".progress-item-wrapper, .search-wrapper, .accordion-wrapper");p&&(p.classList.add("is-highlighted"),p.addEventListener("animationend",()=>{p.classList.remove("is-highlighted")},{once:!0}))},100)})};r?o():ft(e,null,!0).then(o)}async function ns(e){if(e===k.defaultLevel){oe(N("errorTitle","Error"),N("errorDeleteDefaultLevel"));return}if(await mn(N("confirmDeleteLevelTitle","Confirm Deletion"),N("confirmDeleteLevel",{level:e.toUpperCase()})))try{let n=await w;if(await Promise.all([n.delete("levels",e),n.delete("progress",e),En(e)]),u.allAvailableLevels=u.allAvailableLevels.filter(r=>r!==e),u.currentLevel===e)await ia(k.defaultLevel);else{let r=await fetch(`${k.dataPath}/levels.json`),o=r.ok?await r.json():{levels:[]},a=await n.getAllKeys("levels");pn(o.levels||[k.defaultLevel],a),document.querySelectorAll(".level-switch-button").forEach(s=>s.classList.toggle("active",s.dataset.levelName===u.currentLevel))}oe(N("successTitle","Success"),N("successDeleteLevel",{level:e.toUpperCase()}))}catch(n){console.error("Failed to delete level:",n),oe(N("errorTitle","Error"),N("errorDeleteLevel"))}}export{d as a,la as b,k as c,u as d,he as e,ha as f,Ya as g,Qa as h,wn as i,na as j,Za as k,ia as l,Xa as m,es as n,ft as o,ts as p,ns as q,Q as r,un as s,xa as t,tt as u,nt as v,re as w,dn as x,pn as y,Ca as z,oe as A,mn as B,w as C,Da as D,Ia as E,ot as F,vn as G,Ma as H,Ba as I};
