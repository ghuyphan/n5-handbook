import{A as j,C as H,D as U,E as F,F as K,G as O,I as R,a,b as T,c as p,d as l,e as A,f as v,g as B,h as P,i as m,j as u,k as h,l as b,m as k,n as C,o as x,p as I,q as M,r as f,s as w,t as q,u as D,v as z,w as L,x as N,y as V,z as $}from"./chunk-IUSQR5Z6.js";var d;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),d=t,a.installAppBtn&&(a.installAppBtn.style.display="flex")});async function Q(){if(d){d.prompt();let{outcome:t}=await d.userChoice;console.log(`User response to the install prompt: ${t}`),d=null,a.installAppBtn&&(a.installAppBtn.style.display="none")}}window.addEventListener("appinstalled",()=>{a.installAppBtn&&(a.installAppBtn.style.display="none"),d=null,console.log("PWA was installed")});async function X(){let t=["kanji","vocab"],n=[];for(let e of t)l.appData[e]||n.push(K(l.currentLevel,e));if(n.length>0)try{await Promise.all(n)}catch(e){console.error("Failed to load required data for progress dashboard:",e)}}async function y(t,...n){await x(t,...n),t==="progress"&&f();let e=!["progress","external-search"].includes(t),s=document.querySelectorAll(".notes-header-btn");if(s.forEach(o=>{o.style.display=e?"flex":"none"}),e){let o=await R(l.currentLevel,t),i=o&&typeof o=="object"?!!o.content?.trim():!!o?.trim();s.forEach(r=>{r.classList.toggle("has-note",i)})}}function Y(){return'<label class="theme-switch"><input type="checkbox" aria-label="Theme toggle"><span class="slider"></span></label>'}function W(){return'<div class="lang-switch-pill"></div><button data-lang="en">EN</button><button data-lang="vi">VI</button>'}function Z(t){t&&(t.level!==l.currentLevel?b(t.level,!0):y(t.tabName,null,!1,!0))}function _(){document.body.addEventListener("click",n=>{let e=n.target.closest("[data-action]");if(!e)return;let s=e.dataset.action,o={"change-tab":()=>y(e.dataset.tabName,e),"toggle-sidebar":()=>{a.sidebar?.classList.add("open"),a.overlay?.classList.add("active"),document.body.classList.add("sidebar-open")},"toggle-theme":()=>h(),"toggle-pin":()=>k(),"toggle-sidebar-pin":i=>C(i,e.dataset.tabName),"flip-card":()=>{e.closest(".card").classList.toggle("is-flipped")},"toggle-learned":()=>B(e.dataset.category,e.dataset.id,e),"jump-to-section":()=>I(e.dataset.tabName,e.dataset.sectionKey),"delete-level":()=>M(e.dataset.levelName),"set-level":()=>b(e.dataset.levelName),"toggle-accordion":()=>P(e),"clear-search":()=>{let i=e.dataset.target;if(i){let r=document.querySelector(i);r&&(r.value="",r.dispatchEvent(new Event("input",{bubbles:!0})))}}};o[s]&&(s==="toggle-sidebar-pin"?o[s](n):o[s]()),s==="open-notes"&&import("./modals-UTRRIHQT.js").then(i=>i.openNotesModal()),s==="show-kanji-details"&&import("./modals-UTRRIHQT.js").then(i=>i.openKanjiDetailModal(e.dataset.id))}),a.overlay?.addEventListener("click",L),a.searchInput?.addEventListener("input",m),a.mobileSearchInput?.addEventListener("input",m),a.closeSidebarBtn?.addEventListener("click",L);let t=A(()=>{document.querySelectorAll(".lang-switch").forEach(w);let n=window.innerWidth<=768;if(a.pinToggle&&(a.pinToggle.style.display=n?"block":"none",n)){let e=document.querySelector(".tab-content.active");e&&D(e.id)}},100);window.addEventListener("resize",t),window.addEventListener("popstate",n=>{Z(n.state)}),a.installAppBtn&&a.installAppBtn.addEventListener("click",Q)}function ee(){a.sidebarControls&&(a.sidebarControls.innerHTML=`
            <div class="sidebar-control-group"><label class="sidebar-control-label" data-lang-key="level">Level</label><div id="level-switcher-sidebar" class="level-switch"></div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="language">Language</label><div id="sidebar-lang-switcher" class="lang-switch">${W()}</div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="theme">Theme</label><div class="theme-switch-wrapper">${Y()}</div></div>
            <button id="install-app-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button" style="display: none;">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1h4a1 1 0 001-1V2zm-1 5a1 1 0 011 1v10a1 1 0 11-2 0V8a1 1 0 011-1zm-4-4h2V2H5v2zM15 4h-2V2h2v2zm-2 4h-2v10h2V8z"/></svg>
                <span class="pointer-events-none">Install App</span>
            </button>
            <button id="sidebar-import-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L6.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg><span data-lang-key="importLevel" class="pointer-events-none">Import New Level</span></button>`);let t=document.getElementById("header-lang-switcher");t&&(t.innerHTML=W()),document.querySelectorAll(".sidebar-control-group .theme-switch input").forEach(n=>n.addEventListener("change",h)),document.querySelectorAll(".lang-switch button").forEach(n=>n.addEventListener("click",e=>{u(e.currentTarget.dataset.lang)}))}async function te(){T(),await U(),await F(),ee(),_(),q(),document.getElementById("sidebar-import-btn")&&import("./modals-UTRRIHQT.js").then(e=>e.setupImportModal()),a.loadingOverlay&&(a.loadingOverlay.style.opacity="0",a.loadingOverlay.addEventListener("transitionend",()=>a.loadingOverlay.classList.add("hidden"),{once:!0})),u(l.currentLang,!0),document.querySelectorAll(".lang-switch").forEach(w);let t=new URLSearchParams(window.location.search),n=t.get("tab")||l.pinnedTab||(window.innerWidth<=768?"external-search":"hiragana");try{let e=await H,s=fetch(`${p.dataPath}/levels.json`).then(c=>c.ok?c.json():{levels:[]}).catch(c=>(console.warn("Could not fetch remote levels list. Falling back to default.",c),{levels:[p.defaultLevel]})),o=e.getAllKeys("levels"),[i,r]=await Promise.all([s,o]),E=i.levels||[p.defaultLevel];l.allAvailableLevels=[...new Set([...E,...r])];let g=t.get("level");g&&l.allAvailableLevels.includes(g)&&(l.currentLevel=g),await O(l.currentLevel),V(E,r),document.querySelector(`.level-switch-button[data-level-name="${l.currentLevel}"]`)?.classList.add("active"),$(),await N(l.currentLevel),await X(),f(),u(l.currentLang,!0),z(),await y(n,null,!1,!0);let S=document.getElementById("app-version");S&&(S.textContent="v1.0.1");let G={type:"tab",tabName:n,level:l.currentLevel},J=`?level=${l.currentLevel}&tab=${n}`;history.replaceState(G,"",J)}catch(e){console.error("Deferred initialization failed.",e),a.loadingOverlay&&j(v("applicationErrorTitle","Application Error"),v("applicationErrorBody","Something went wrong during startup. Please try refreshing the page.")+`

Error: ${e.message}`)}}document.addEventListener("DOMContentLoaded",te);
