import{B as $,C as H,D as O,E as U,F,G as K,I as R,a as o,b as E,c as u,d as l,e as S,f as T,g as I,h as m,i as p,j as B,k as v,l as C,m as k,n as x,o as A,p as P,q as h,r as b,s as D,t as M,u as q,v as f,w as j,x as z,y as N,z as V}from"./chunk-Z44HCORZ.js";var c;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),c=e;let a=document.getElementById("install-app-btn");a&&(a.style.display="flex")});async function X(){if(c){c.prompt();let{outcome:e}=await c.userChoice;console.log(`User response to the install prompt: ${e}`),c=null;let a=document.getElementById("install-app-btn");a&&(a.style.display="none")}}window.addEventListener("appinstalled",()=>{let e=document.getElementById("install-app-btn");e&&(e.style.display="none"),c=null,console.log("PWA was installed")});var W=(e,a={})=>{let t=l.appData.ui?.[l.currentLang]?.[e]||l.appData.ui?.en?.[e]||`[${e}]`;e==="lastSavedOn"&&!l.appData.ui?.[l.currentLang]?.[e]&&(t="Last saved: {date}");for(let[n,s]of Object.entries(a))t=t.replace(`{${n}}`,s);return t};async function Y(){let e=["kanji","vocab"],a=[];for(let t of e)l.appData[t]||a.push(F(l.currentLevel,t));if(a.length>0)try{await Promise.all(a)}catch(t){console.error("Failed to load required data for progress dashboard:",t)}}async function w(e,...a){await x(e,...a),e==="progress"&&h();let t=!["progress","external-search"].includes(e),n=document.querySelectorAll(".notes-header-btn");if(n.forEach(s=>{s.style.display=t?"flex":"none"}),t){let s=await R(l.currentLevel,e),r=s&&typeof s=="object"?!!s.content?.trim():!!s?.trim();n.forEach(i=>{i.classList.toggle("has-note",r)})}}function Z(){return'<label class="theme-switch"><input type="checkbox" aria-label="Theme toggle"><span class="slider"></span></label>'}function G(){return'<div class="lang-switch-pill"></div><button data-lang="en">EN</button><button data-lang="vi">VI</button>'}function _(e){e&&(e.level!==l.currentLevel?v(e.level,!0):w(e.tabName,null,!1,!0))}function ee(){let e=document.documentElement.classList.toggle("dark-mode"),a=e?"dark":"light";o.themeEmoji&&(o.themeEmoji.textContent=e?"\u{1F319}":"\u2600\uFE0F");let t=document.querySelector("#sidebar-controls .theme-switch input");t&&(t.checked=e),U("theme",a);try{localStorage.setItem("theme",a)}catch(n){console.warn("Could not save theme to localStorage.",n)}}function te(){document.body.addEventListener("click",t=>{let n=t.target.closest("[data-action]");if(!n)return;let s=n.dataset.action,r={"change-tab":()=>w(n.dataset.tabName,n),"toggle-sidebar":()=>{o.sidebar?.classList.add("open"),o.overlay?.classList.add("active"),document.body.classList.add("sidebar-open")},"toggle-theme":()=>ee(),"toggle-pin":()=>C(),"toggle-sidebar-pin":i=>k(i,n.dataset.tabName),"flip-card":()=>{n.closest(".card").classList.toggle("is-flipped")},"toggle-learned":()=>T(n.dataset.category,n.dataset.id,n),"jump-to-section":()=>A(n.dataset.tabName,n.dataset.sectionKey),"delete-level":()=>P(n.dataset.levelName),"set-level":()=>v(n.dataset.levelName),"toggle-accordion":()=>I(n)};r[s]&&(s==="toggle-sidebar-pin"?r[s](t):r[s]()),s==="open-notes"&&import("./modals-4OAF2EHG.js").then(i=>i.openNotesModal()),s==="show-kanji-details"&&import("./modals-4OAF2EHG.js").then(i=>i.openKanjiDetailModal(n.dataset.id))}),o.overlay?.addEventListener("click",f),o.searchInput?.addEventListener("input",m),o.mobileSearchInput?.addEventListener("input",m),o.closeSidebarBtn?.addEventListener("click",f);let e=S(()=>{document.querySelectorAll(".lang-switch").forEach(b);let t=window.innerWidth<=768;if(o.pinToggle&&(o.pinToggle.style.display=t?"block":"none",t)){let n=document.querySelector(".tab-content.active");n&&M(n.id)}},100);window.addEventListener("resize",e),window.addEventListener("popstate",t=>{_(t.state)});let a=document.getElementById("install-app-btn");a&&a.addEventListener("click",X)}function ae(){o.sidebarControls&&(o.sidebarControls.innerHTML=`
            <div class="sidebar-control-group"><label class="sidebar-control-label" data-lang-key="level">Level</label><div id="level-switcher-sidebar" class="level-switch"></div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="language">Language</label><div id="sidebar-lang-switcher" class="lang-switch">${G()}</div></div>
            <div class="sidebar-control-group md:hidden"><label class="sidebar-control-label" data-lang-key="theme">Theme</label><div class="theme-switch-wrapper">${Z()}</div></div>
            <button id="install-app-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button" style="display: none;">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1h4a1 1 0 001-1V2zm-1 5a1 1 0 011 1v10a1 1 0 11-2 0V8a1 1 0 011-1zm-4-4h2V2H5v2zM15 4h-2V2h2v2zm-2 4h-2v10h2V8z"/></svg>
                <span class="pointer-events-none">Install App</span>
            </button>
            <button id="sidebar-import-btn" class="w-full mt-4 flex items-center justify-center gap-2 text-sm font-semibold p-3 rounded-lg transition-colors import-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L6.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg><span data-lang-key="importLevel" class="pointer-events-none">Import New Level</span></button>`);let e=document.getElementById("header-lang-switcher");e&&(e.innerHTML=G()),document.querySelectorAll(".sidebar-control-group .theme-switch input").forEach(a=>a.addEventListener("change",B)),document.querySelectorAll(".lang-switch button").forEach(a=>a.addEventListener("click",t=>{p(t.currentTarget.dataset.lang)}))}async function ne(){E(),await H(),await O(),ae(),te(),D(),document.getElementById("sidebar-import-btn")&&import("./modals-4OAF2EHG.js").then(t=>t.setupImportModal()),o.loadingOverlay&&(o.loadingOverlay.style.opacity="0",o.loadingOverlay.addEventListener("transitionend",()=>o.loadingOverlay.classList.add("hidden"),{once:!0})),p(l.currentLang,!0),document.querySelectorAll(".lang-switch").forEach(b);let e=new URLSearchParams(window.location.search),a=e.get("tab")||l.pinnedTab||(window.innerWidth<=768?"external-search":"hiragana");try{let t=await $,n=fetch(`${u.dataPath}/levels.json`).then(d=>d.ok?d.json():{levels:[]}).catch(d=>(console.warn("Could not fetch remote levels list. Falling back to default.",d),{levels:[u.defaultLevel]})),s=t.getAllKeys("levels"),[r,i]=await Promise.all([n,s]),L=r.levels||[u.defaultLevel];l.allAvailableLevels=[...new Set([...L,...i])];let g=e.get("level");g&&l.allAvailableLevels.includes(g)&&(l.currentLevel=g),await K(l.currentLevel),z(L,i),document.querySelector(`.level-switch-button[data-level-name="${l.currentLevel}"]`)?.classList.add("active"),N(),await j(l.currentLevel),await Y(),h(),p(l.currentLang,!0),q(),await w(a,null,!1,!0);let y=document.getElementById("app-version");y&&(y.textContent="v1.0.1");let J={type:"tab",tabName:a,level:l.currentLevel},Q=`?level=${l.currentLevel}&tab=${a}`;history.replaceState(J,"",Q)}catch(t){console.error("Deferred initialization failed.",t),o.loadingOverlay&&V(W("applicationErrorTitle","Application Error"),W("applicationErrorBody","Something went wrong during startup. Please try refreshing the page.")+`

Error: ${t.message}`)}}document.addEventListener("DOMContentLoaded",ne);
